<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xml:lang=
"en-US">
<head>
<title>Java Authentication and Authorization Service (JAAS): LoginModule Developer's Guide</title>
<link rel="stylesheet" type="text/css" href="../../../../technotes/css/guide.css" />
</head>
<body>
<!-- STATIC HEADER -->

<!-- header start -->
<div id="javaseheader">
<div id="javaseheaderlogo">
<img src="../../../../images/javalogo.gif"
alt="Java logo" />
</div>
<div id="javaseheaderindex">

<a href=
"../../../../index.html">Documentation Contents</a>
</div>
<div class="clear"></div>
</div>

<!-- header end -->


<h1>Java Authentication and Authorization Service (JAAS): LoginModule Developer's Guide</h1>

<ul>
  <li><a href="#Overview">Overview</a>
    <ul>
      <li><a href="#Who">Who Should Read This Document</a></li>
      <li><a href="#RelatedDocs">Related Documentation</a></li>
      <li><a href="#Intro">Introduction</a></li>
    </ul>
  </li>
  <li><a href="#Steps">Steps to Implement a <code>LoginModule</code></a>
    <ul>
      <li><a href="#Step_1">Step 1: Understand the Authentication Technology</a></li>
      <li><a href="#Step_2">Step 2: Name the <code>LoginModule</code> Implementation</a></li>
      <li><a href="#Step_3">Step 3: Implement the Abstract <code>LoginModule</code> Methods</a></li>
      <li><a href="#Step_4">Step 4: Choose or Write a Sample Application</a></li>
      <li><a href="#Step_5">Step 5: Compile the <code>LoginModule</code> and Application</a></li>
      <li><a href="#Step_6">Step 6: Prepare for Testing</a></li>
      <li><a href="#Step_7">Step 7: Test Use of the <code>LoginModule</code></a></li>
      <li><a href="#Step_8">Step 8: Document Your <code>LoginModule</code> Implementation</a></li>
      <li><a href="#Step_9">Step 9: Make <code>LoginModule</code> JAR File and Documents Available</a></li>
    </ul>
  </li>
</ul>

<!-- ******************************************************************* -->

<h2><a name="Overview" id="Overview">Overview</a></h2>

<p>The Java Authentication and Authorization Service (JAAS) was
introduced as an optional package to the Java 2 SDK, Standard
Edition (J2SDK), v 1.3. JAAS was integrated into the Java
Standard Edition Development Kit starting with J2SDK 1.4.</p>

<p>JAAS provides subject-based authorization on authenticated
identities. This document focuses on the authentication aspect of
JAAS, specifically the <a href=
"../../../../api/javax/security/auth/spi/LoginModule.html"><code>LoginModule</code></a>
interface.</p>

<!-- ******************************************************************* -->

<h3><a name="Who" id="Who">Who Should Read This Document</a></h3>

<p>This document is intended for experienced programmers who
require the ability to write a <a href=
"../../../../api/javax/security/auth/spi/LoginModule.html"><code>LoginModule</code></a>
implementing an authentication technology.</p>

<!-- ******************************************************************* -->

<h3><a name="RelatedDocs" id="RelatedDocs">Related
Documentation</a></h3>

<p>This document assumes you have already read the following:</p>

<ul>
<li><a href="JAASRefGuide.html">JAAS Reference Guide</a></li>
</ul>

<p>It also discusses various classes and interfaces in the JAAS
API. Please reference the javadocs for the JAAS API specification
for more detailed information:</p>

<ul>
<li><a href=
"../../../../api/javax/security/auth/package-summary.html">javax.security.auth
Package</a></li>

<li><a href=
"../../../../api/javax/security/auth/callback/package-summary.html">
javax.security.auth.callback Package</a></li>

<li><a href=
"../../../../api/javax/security/auth/kerberos/package-summary.html">
javax.security.auth.kerberos Package</a></li>

<li><a href=
"../../../../api/javax/security/auth/login/package-summary.html">javax.security.auth.login
Package</a></li>

<li><a href=
"../../../../api/javax/security/auth/spi/package-summary.html">javax.security.auth.spi
Package</a></li>

<li><a href=
"../../../../api/javax/security/auth/x500/package-summary.html">javax.security.auth.x500
Package</a></li>

<li><a href=
"../../../../jre/api/security/jaas/spec/com/sun/security/auth/package-summary.html">
com.sun.security.auth Package</a></li>

<li><a href=
"../../../../jre/api/security/jaas/spec/com/sun/security/auth/callback/package-summary.html">
com.sun.security.auth.callback Package</a></li>

<li><a href=
"../../../../jre/api/security/jaas/spec/com/sun/security/auth/login/package-summary.html">
com.sun.security.auth.login Package</a></li>

<li><a href=
"../../../../jre/api/security/jaas/spec/com/sun/security/auth/module/package-summary.html">
com.sun.security.auth.module Package</a></li>
</ul>

<p>The following <b>tutorials</b> for JAAS authentication and
authorization can be run by everyone:</p>

<ul>
<li><a href="tutorials/GeneralAcnOnly.html">JAAS Authentication
Tutorial</a></li>

<li><a href="tutorials/GeneralAcnAndAzn.html">JAAS Authorization
Tutorial</a></li>
</ul>

<p>Similar tutorials for JAAS authentication and authorization,
but which demonstrate the use of a Kerberos LoginModule and thus
which require a Kerberos installation, can be found at</p>

<ul>
<li><a href="../jgss/tutorials/AcnOnly.html">JAAS
Authentication</a></li>

<li><a href="../jgss/tutorials/AcnAndAzn.html">JAAS
Authorization</a></li>
</ul>

<p>These two tutorials are a part of the <a href=
"../jgss/tutorials/index.html">Java GSS-API and JAAS sequence of
tutorials</a> that utilize Kerberos as the underlying technology
for authentication and secure communication.</p>

<!-- ******************************************************************* -->

<h3><a name="Intro" id="Intro">Introduction</a></h3>

<p>The <a href=
"../../../../api/javax/security/auth/spi/LoginModule.html"><code>LoginModule</code></a>
documentation describes the interface that must be implemented by
authentication technology providers. <code>LoginModule</code>s
are plugged in under applications to provide a particular type of
authentication.</p>

<p>While applications write to the <a href=
"../../../../api/javax/security/auth/login/LoginContext.html"><code>
LoginContext</code></a> Application Programming Interface (API),
authentication technology providers implement the
<code>LoginModule</code> interface. A <a href=
"../../../../api/javax/security/auth/login/Configuration.html"><code>
Configuration</code></a> specifies the
<code>LoginModule</code>(s) to be used with a particular login
application. Different <code>LoginModule</code>s can be plugged
in under the application without requiring any modifications to
the application itself.</p>

<p>The <code>LoginContext</code> is responsible for reading the
<code>Configuration</code> and instantiating the specified
<code>LoginModule</code>s. Each <code>LoginModule</code> is
initialized with a <a href=
"../../../../api/javax/security/auth/Subject.html"><code>Subject</code></a>,
a <a href=
"../../../../api/javax/security/auth/callback/CallbackHandler.html">
<code>CallbackHandler</code></a>, shared <code>LoginModule</code>
state, and <code>LoginModule</code>-specific options.</p>

<p>The <b><code>Subject</code></b> represents the user or service
currently being authenticated and is updated by a
<code>LoginModule</code> with relevant <a href=
"../../../../api/java/security/Principal.html"><code>Principal</code>s</a>
and credentials if authentication succeeds.
<code>LoginModule</code>s use the
<b><code>CallbackHandler</code></b> to communicate with users (to
prompt for user names and passwords, for example), as described
in the <a href="#login">login</a> method description. Note that
the <code>CallbackHandler</code> may be null. A
<code>LoginModule</code> that requires a
<code>CallbackHandler</code> to authenticate the
<code>Subject</code> may throw a <a href=
"../../../../api/javax/security/auth/login/LoginException.html"><code>
LoginException</code></a> if it was initialized with a
<code>null</code> <code>CallbackHandler</code>.
<code>LoginModule</code>s optionally use the <b>shared state</b>
to share information or data among themselves.</p>

<p>The <b><code>LoginModule</code>-specific options</b> represent
the options configured for this <code>LoginModule</code> in the
login <code>Configuration</code>. The options are defined by the
<code>LoginModule</code> itself and control the behavior within
it. For example, a <code>LoginModule</code> may define options to
support debugging/testing capabilities. Options are defined using
a key-value syntax, such as <i>debug=true</i>. The
<code>LoginModule</code> stores the options as a <code>Map</code>
so that the values may be retrieved using the key. Note that
there is no limit to the number of options a
<code>LoginModule</code> chooses to define.</p>

<p>The calling application sees the authentication process as a
single operation invoked via a call to the
<code>LoginContext</code>'s <code>login</code> method. However,
the authentication process within each <code>LoginModule</code>
proceeds in two distinct phases. In the first phase of
authentication, the <code>LoginContext</code>'s
<code>login</code> method invokes the <code>login</code> method
of each <code>LoginModule</code> specified in the
<code>Configuration</code>. The <code>login</code> method for a
<code>LoginModule</code> performs the actual authentication
(prompting for and verifying a password for example) and saves
its authentication status as private state information. Once
finished, the <code>LoginModule</code>'s <code>login</code>
method returns <code>true</code> (if it succeeded) or
<code>false</code> (if it should be ignored), or it throws a
<code>LoginException</code> to specify a failure. In the failure
case, the <code>LoginModule</code> must not retry the
authentication or introduce delays. The responsibility of such
tasks belongs to the application. If the application attempts to
retry the authentication, each <code>LoginModule</code>'s
<code>login</code> method will be called again.</p>

<p>In the second phase, if the <code>LoginContext</code>'s
overall authentication succeeded (calls to the relevant
<i>required</i>, <i>requisite</i>, <i>sufficient</i> and
<i>optional</i> <code>LoginModule</code>s' <code>login</code>
methods succeeded), then the <code>commit</code> method for each
<code>LoginModule</code> gets invoked. (For an explanation of the
<code>LoginModule</code> flags <i>required</i>, <i>requisite</i>,
<i>sufficient</i> and <i>optional</i>, please consult the <a
href=
"../../../../api/javax/security/auth/login/Configuration.html"><code>
javax.security.auth.login.Configuration</code></a> documentation
and <a href="JAASRefGuide.html#AppendixB">Appendix B: Login
Configuration Files</a> in the JAAS Reference Guide.) The
<code>commit</code> method for a <code>LoginModule</code> checks
its privately saved state to see if its own authentication
succeeded. If the overall <code>LoginContext</code>
authentication succeeded and the <code>LoginModule</code>'s own
authentication succeeded, then the <code>commit</code> method
associates the relevant <code>Principal</code>s (authenticated
identities) and credentials (authentication data such as
cryptographic keys) with the <code>Subject</code>.</p>

<p>If the <code>LoginContext</code>'s overall authentication
failed (the relevant REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL
<code>LoginModule</code>s' <code>login</code> methods did not
succeed), then the <code>abort</code> method for each
<code>LoginModule</code> gets invoked. In this case, the
<code>LoginModule</code> removes/destroys any authentication
state originally saved.</p>

<p>Logging out a <code>Subject</code> involves only one phase.
The <code>LoginContext</code> invokes the
<code>LoginModule</code>'s <code>logout</code> method. The
<code>logout</code> method for the <code>LoginModule</code> then
performs the logout procedures, such as removing
<code>Principal</code>s or credentials from the
<code>Subject</code>, or logging session information.</p>

<!-- ******************************************************************* -->

<h2><a name="Steps" id="Steps">Steps to Implement a
<code>LoginModule</code></a></h2>

<p>The steps required in order to implement and test a
<code>LoginModule</code> are the following:</p>

    <ul>
      <li><a href="#Step_1">Step 1: Understand the Authentication Technology</a></li>
      <li><a href="#Step_2">Step 2: Name the <code>LoginModule</code> Implementation</a></li>
      <li><a href="#Step_3">Step 3: Implement the Abstract <code>LoginModule</code> Methods</a></li>
      <li><a href="#Step_4">Step 4: Choose or Write a Sample Application</a></li>
      <li><a href="#Step_5">Step 5: Compile the <code>LoginModule</code> and Application</a></li>
      <li><a href="#Step_6">Step 6: Prepare for Testing</a>
        <ul>
          <li><a href="#Step_6a">Step 6a: Place Your <code>LoginModule</code> and Application Code in JAR Files</a></li>
          <li><a href="#Step_6a"></a><a href="#Step_6b">Step 6b: Decide Where to Store the JAR Files</a></li>
          <li><a href="#Step_6b"></a><a href="#Step_6c">Step 6c: Set <code>LoginModule</code> and Application JAR File Permissions</a></li>
          <li><a href="#Step_6d">Step 6d: Create a Configuration Referencing the LoginModule</a></li>
        </ul>
      </li>
      <li><a href="#Step_7">Step 7: Test Use of the <code>LoginModule</code></a></li>
      <li><a href="#Step_8">Step 8: Document Your <code>LoginModule</code> Implementation</a></li>
      <li><a href="#Step_9">Step 9: Make <code>LoginModule</code> JAR File and Documents Available</a></li>
    </ul>

<p>The steps required to implement and test a new
<code>LoginModule</code> follow. Please reference the <a href=
"tutorials/SampleLoginModule.java">SampleLoginModule</a> and
other files described in the <a href="JAASRefGuide.html">JAAS
Reference Guide</a> for examples of what may be done for the
various steps.<br />
</p>

<!-- ******************************************************************* -->

<h3><a name="Step_1">Step 1: Understand the Authentication
Technology</a></h3>

<p>The first thing you need to do is understand the authentication
technology to be implemented by your new <code>LoginModule</code>
provider, and determine its requirements.</p> 

<p>One thing you will need to determine is whether or not your
<code>LoginModule</code> will require some form of user
interaction (retrieving a user name and password, for example).
If so, you will need to become familiar with the <a href=
"../../../../api/javax/security/auth/callback/CallbackHandler.html">
<code>CallbackHandler</code></a> interface and the <a href=
"../../../../api/javax/security/auth/callback/package-summary.html">
<code>javax.security.auth.callback</code></a> package. In that
package you will find several possible <code>Callback</code>
implementations to use. (Alternatively, you can create your own
<code>Callback</code> implementations.) The
<code>LoginModule</code> will invoke the
<code>CallbackHandler</code> specified by the application itself
and passed to the <code>LoginModule</code>'s
<code>initialize</code> method. The <code>LoginModule</code>
passes the <code>CallbackHandler</code> an array of appropriate
<code>Callback</code>s. See the <a href="#login">login</a> method
in Step 3.</p>

<p>Note that it is possible for <code>LoginModule</code>
implementations not to have any end-user interactions. Such
<code>LoginModule</code>s would not need to access the
<code>callback</code> package.</p>

<p>Another thing you should determine is what configuration
options you want to make available to the user, who specifies
configuration information in whatever form the current
Configuration implementation expects (for example, in files). For
each option, decide the option name and possible values. For
example, if a <code>LoginModule</code> may be configured to
consult a particular authentication server host, decide on the
option's key name ("auth_server", for example), as well as the
possible server hostnames valid for that option
("server_one.example.com" and "server_two.example.com", for
example).</p>

<!-- ******************************************************************* -->

<h3><a name="Step_2">Step 2: Name the <code>LoginModule</code>
Implementation</a></h3>

<p>Decide on the proper package and class name for your
<code>LoginModule</code>.</p> 

<p>For example, a <code>LoginModule</code> developed by IBM might
be called <code>com.ibm.auth.Module</code> where
<code>com.ibm.auth</code> is the package name and
<code>Module</code> is the name of the <code>LoginModule</code>
class implementation.</p>

<!-- ******************************************************************* -->

<h3><a name="Step_3">Step 3: Implement the Abstract
<code>LoginModule</code> Methods</a></h3>

<p>The <code>LoginModule</code> interface specifies five abstract
methods that require implementations:</p>

<ul>
<li><a href="#initialize">initialize</a></li>

<li><a href="#login">login</a></li>

<li><a href="#commit">commit</a></li>

<li><a href="#abort">abort</a></li>

<li><a href="#logout">logout</a></li>
</ul>

<p>See below and the <a href=
"../../../../api/javax/security/auth/spi/LoginModule.html"><code>LoginModule</code>
API</a> for more information on each method above.</p> 

<p>In addition to these methods, a <code>LoginModule</code>
implementation must provide a public constructor with no
arguments. This allows for its proper instantiation by a
<code>LoginContext</code>. Note that if no such constructor is
provided in your <code>LoginModule</code> implementation, a
default no-argument constructor is automatically inherited from
the <code>Object</code> class.</p>

<!-- ******************************************************************* -->

<h4><a name="initialize" id=
"initialize"></a>LoginModule.initialize Method</h4>

<pre>
public void initialize (
  Subject subject,
  CallbackHandler handler,
  Map&lt;java.lang.String, ?&gt; sharedState,
  Map&lt;java.lang.String, ?&gt; options) { ... }
</pre>

<!-- **** older signature
<h3>void initialize(Subject subject,
                    <code>CallbackHandler</code> <code>CallbackHandler</code>,
                Map sharedState, Map options);</h3>

******* -->
<p>The <code>initialize</code> method is called to initialize the
<code>LoginModule</code> with the relevant authentication and
state information.</p>

<p>This method is called by a <code>LoginContext</code>
immediately after this <code>LoginModule</code> has been
instantiated, and prior to any calls to its other public methods.
The method implementation should store away the provided
arguments for future use.</p>

<p>The <code>initialize</code> method may additionally peruse the
provided <i>sharedState</i> to determine what additional
authentication state it was provided by other
<code>LoginModule</code>s, and may also traverse through the
provided <i>options</i> to determine what configuration options
were specified to affect the <code>LoginModule</code>'s behavior.
It may save option values in variables for future use.</p>

<p>Note: JAAS LoginModules may use the options defined in PAM
(<code>use_first_pass</code>, <code>try_first_pass</code>,
<code>use_mapped_pass</code>, and <code>try_mapped_pass</code>)
to achieve single-sign on. See <a href="http://www.oracle.com/us/sun/index.htm">Making
Login Services Independent from Authentication Technologies</a>
for further information.</p>

<p>Below is a list of options commonly supported by LoginModules.
Note that the following is simply a guideline. Modules are free
to support a subset (or none) of the following options.</p>

<ul>
<li><code>try_first_pass</code> - If <code>true</code>, the first
LoginModule in the stack saves the password entered, and
subsequent LoginModules also try to use it. If authentication
fails, the LoginModules prompt for a new password and retry the
authentication.</li>

<li><code>use_first_pass</code> - If <code>true</code>, the first
LoginModule in the stack saves the password entered, and
subsequent LoginModules also try to use it. LoginModules do not
prompt for a new password if authentication fails (authentication
simply fails).</li>

<li><code>try_mapped_pass</code> - If <code>true</code>, the
first LoginModule in the stack saves the password entered, and
subsequent LoginModules attempt to map it into their
service-specific password. If authentication fails, the
LoginModules prompt for a new password and retry the
authentication.</li>

<li><code>use_mapped_pass</code> - If <code>true</code>, the
first LoginModule in the stack saves the password entered, and
subsequent LoginModules attempt to map it into their
service-specific password. LoginModules do not prompt for a new
password if authentication fails (authentication simply
fails).</li>

<li><code>moduleBanner</code> - If <code>true</code>, then when
invoking the CallbackHandler, the LoginModule provides a
TextOutputCallback as the first Callback, which describes the
LoginModule performing the authentication.</li>

<li><code>debug</code> - If <code>true</code>, instructs a
LoginModule to output debugging information.</li>
</ul>

<p>The <code>initialize</code> method may freely ignore state or
options it does not understand, although it would be wise to log
such an event if it does occur.</p>

<p>Note that the <code>LoginContext</code> invoking this
<code>LoginModule</code> (and the other configured
<code>LoginModule</code>s, as well), all share the same
references to the provided <code>Subject</code> and
<code>sharedState</code>. Modifications to the
<code>Subject</code> and <code>sharedState</code> will,
therefore, be seen by all.</p>

<!-- ******************************************************************* -->

<h4><a name="login" id="login"></a>LoginModule.login Method</h4>

<pre>
boolean login() throws LoginException;
</pre>

<p>The <code>login</code> method is called to authenticate a
<code>Subject</code>. This is phase 1 of authentication.</p>

<p>This method implementation should perform the actual
authentication. For example, it may cause prompting for a user
name and password, and then attempt to verify the password
against a password database. Another example implementation may
inform the user to insert their finger into a fingerprint reader,
and then match the input fingerprint against a fingerprint
database.</p>

<p>If your <code>LoginModule</code> requires some form of user
interaction (retrieving a user name and password, for example),
it should not do so directly. That is because there are various
ways of communicating with a user, and it is desirable for
<code>LoginModule</code>s to remain independent of the different
types of user interaction. Rather, the <code>LoginModule</code>'s
<code>login</code> method should invoke the <code>handle</code>
method of the <a href=
"../../../../api/javax/security/auth/callback/CallbackHandler.html">
<code>CallbackHandler</code></a> passed to the
<code>initialize</code> method to perform the user interaction
and set appropriate results, such as the user name and password.
The <code>LoginModule</code> passes the
<code>CallbackHandler</code> an array of appropriate
<code>Callback</code>s, for example a <a href=
"../../../../api/javax/security/auth/callback/NameCallback.html">NameCallback</a>
for the user name and a <a href=
"../../../../api/javax/security/auth/callback/PasswordCallback.html">
PasswordCallback</a> for the password, and the
<code>CallbackHandler</code> performs the requested user
interaction and sets appropriate values in the
<code>Callback</code>s. For example, to process a
<code>NameCallback</code>, the <code>CallbackHandler</code> may
prompt for a name, retrieve the value from the user, and call the
<code>NameCallback</code>'s <code>setName</code> method to store
the name.</p>

<p>The authentication process may also involve communication over
a network. For example, if this method implementation performs
the equivalent of a <i>kinit</i> in Kerberos, then it would need
to contact the KDC. If a password database entry itself resides
in a remote naming service, then that naming service needs to be
contacted, perhaps via the Java Naming and Directory Interface
(JNDI). Implementations might also interact with an underlying
operating system. For example, if a user has already logged into
an operating system like Solaris, Linux, Mac OS X, or Windows NT,
this method might
simply import the underlying operating system's identity
information.</p>

<p>The <code>login</code> method should</p>

<ol>
<li>Determine whether or not this <code>LoginModule</code> should
be ignored. One example of when it should be ignored is when a
user attempts to authenticate under an identity irrelevant to
this <code>LoginModule</code> (if a user attempts to authenticate
as <i>root</i> using NIS, for example). If this
<code>LoginModule</code> should be ignored, <code>login</code>
should return <code>false</code>. Otherwise, it should do the
following:</li>

<li>Call the <code>CallbackHandler</code> <code>handle</code>
method if user interaction is required.</li>

<li>Perform the authentication.</li>

<li>Store the authentication result (success or failure).</li>

<li>If authentication succeeded, save any relevant state
information that may be needed by the <code>commit</code>
method.</li>

<li>Return <code>true</code> if authentication succeeds, or throw
a <a href=
"../../../../api/javax/security/auth/login/LoginException.html"><code>
LoginException</code></a> such as <a href=
"../../../../api/javax/security/auth/login/FailedLoginException.html">
<code>FailedLoginException</code></a> if authentication
fails.</li>
</ol>

<p>Note that the <code>login</code> method implementation should
not associate any new <code>Principal</code> or credential
information with the saved <code>Subject</code> object. This
method merely performs the authentication, and then stores away
the authentication result and corresponding authentication state.
This result and state will later be accessed by the
<code>commit</code> or <code>abort</code> method. Note that the
result and state should typically not be saved in the
<i>sharedState</i> <code>Map</code>, as they are not intended to
be shared with other <code>LoginModule</code>s.</p>

<p>An example of where this method might find it useful to store
state information in the <i>sharedState</i> <code>Map</code> is
when <code>LoginModule</code>s are configured to share passwords.
In this case, the entered password would be saved as shared
state. By sharing passwords, the user only enters the password
once, and can still be authenticated to multiple
<code>LoginModule</code>s. The standard conventions for saving
and retrieving names and passwords from the <i>sharedState</i>
<code>Map</code> are the following:</p>

<ul>
<li><code>javax.security.auth.login.name</code> - Use this as the
shared state map key for saving/retrieving a name.</li>

<li><code>javax.security.auth.login.password</code> - Use this as
the shared state map key for saving/retrieving a password.</li>
</ul>

<p>If authentication fails, the <code>login</code> method should
not retry the authentication. This is the responsibility of the
application. Multiple <code>LoginContext</code>
<code>login</code> method calls by an application are preferred
over multiple login attempts from within
<code>LoginModule.login()</code>.</p>

<!-- ******************************************************************* -->

<h4><a name="commit" id="commit"></a>LoginModule.commit
Method</h4>

<pre>
boolean commit() throws LoginException;
</pre>

<p>The <code>commit</code> method is called to commit the
authentication process. This is phase 2 of authentication when
phase 1 succeeds. It is called if the <code>LoginContext</code>'s
overall authentication succeeded (that is, if the relevant
REQUIRED, REQUISITE, SUFFICIENT and OPTIONAL
<code>LoginModule</code>s succeeded.)</p>

<p>This method should access the authentication result and
corresponding authentication state saved by the
<code>login</code> method.</p>

<p>If the authentication result denotes that the
<code>login</code> method failed, then this <code>commit</code>
method should remove/destroy any corresponding state that was
originally saved.</p>

<p>If the saved result instead denotes that this
<code>LoginModule</code>'s <code>login</code> method succeeded,
then the corresponding state information should be accessed to
build any relevant <code>Principal</code> and credential
information. Such <code>Principal</code>s and credentials should
then be added to the <code>Subject</code> stored away by the
<code>initialize</code> method.</p>

<p>After adding <code>Principal</code>s and credentials,
dispensable state fields should be destroyed expeditiously.
Likely fields to destroy would be user names and passwords stored
during the authentication process.</p>

<p>The <code>commit</code> method should save private state
indicating whether the commit succeeded or failed.</p>

<p>The following chart depicts what a <code>LoginModule</code>'s
<code>commit</code> method should return. The different boxes
represent the different situations that may occur. For example,
the top-left corner box depicts what the <code>commit</code>
method should return if both the previous call to
<code>login</code> succeeded and the <code>commit</code> method
itself succeeded.</p>

<table summary="LoginModule.commit method return values" border=
"1">
<caption>LoginModule.commit method return values</caption>

<tr>
<td headers="h1">&nbsp;</td>
<th id="h1">COMMIT: SUCCESS</th>
<th id="h2">COMMIT: FAILURE</th>
</tr>

<tr>
<th id="h3">LOGIN: SUCCESS</th>
<td headers="h1">return TRUE</td>
<td headers="h2">throw EXCEPTION</td>
</tr>

<tr>
<th id="h4">LOGIN: FAILURE</th>
<td headers="h1">return FALSE</td>
<td headers="h2">return FALSE</td>
</tr>
</table>

<!-- ******************************************************************* -->

<h4><a name="abort" id="abort"></a>LoginModule.abort Method</h4>

<pre>
boolean abort() throws LoginException;
</pre>

<p>The <code>abort</code> method is called to abort the
authentication process. This is phase 2 of authentication when
phase 1 fails. It is called if the <code>LoginContext</code>'s
overall authentication failed.</p>

<p>This method first accesses this <code>LoginModule</code>'s
authentication result and corresponding authentication state
saved by the <code>login</code> (and possibly
<code>commit</code>) methods, and then clears out and destroys
the information. Sample state to destroy would be user names and
passwords.</p>

<p>If this <code>LoginModule</code>'s authentication attempt
failed, then there shouldn't be any private state to clean
up.</p>

<p>The following charts depict what a <code>LoginModule</code>'s
<code>abort</code> method should return. This first chart assumes
that the previous call to <code>login</code> succeeded. For
instance, the top-left corner box depicts what the
<code>abort</code> method should return if both the previous call
to <code>login</code> and <code>commit</code> succeeded, and the
<code>abort</code> method itself also succeeded.</p>

<table summary=
"LoginModule.abort method return values; login succeeded" border=
"1">
<caption>LoginModule.abort method return values; login
succeeded</caption>

<tr>
<td headers="h101">&nbsp;</td>
<th id="h101">ABORT: SUCCESS</th>
<th id="h102">ABORT: FAILURE</th>
</tr>

<tr>
<th id="h103">COMMIT: SUCCESS</th>
<td headers="h101">return TRUE</td>
<td headers="h102">throw EXCEPTION</td>
</tr>

<tr>
<th id="h104">COMMIT: FAILURE</th>
<td headers="h101">return TRUE</td>
<td headers="h102">throw EXCEPTION</td>
</tr>
</table>

<p>The second chart depicts what a <code>LoginModule</code>'s
<code>abort</code> method should return, assuming that the
previous call to <code>login</code> failed. For instance, the
top-left corner box depicts what the <code>abort</code> method
should return if the previous call to <code>login</code> failed,
the previous call to <code>commit</code> succeeded, and the
<code>abort</code> method itself also succeeded.</p>

<table summary=
"LoginModule.abort method return values; login failed" border=
"1">
<caption>LoginModule.abort method return values; login
failed</caption>

<tr>
<td headers="h201">&nbsp;</td>
<th id="h201">ABORT: SUCCESS</th>
<th id="h202">ABORT: FAILURE</th>
</tr>

<tr>
<th id="h203">COMMIT: SUCCESS</th>
<td headers="h201">return FALSE</td>
<td headers="h202">return FALSE</td>
</tr>

<tr>
<th id="h204">COMMIT: FAILURE</th>
<td headers="h201">return FALSE</td>
<td headers="h202">return FALSE</td>
</tr>
</table>

<!-- ******************************************************************* -->

<h4><a name="logout" id="logout"></a>LoginModule.logout
Method</h4>

<pre>
boolean logout() throws LoginException;
</pre>

<p>The <code>logout</code> method is called to log out a
<code>Subject</code>.</p>

<p>This method removes <code>Principal</code>s, and
removes/destroys credentials associated with the
<code>Subject</code> during the <code>commit</code> operation.
This method should not touch those <code>Principal</code>s or
credentials previously existing in the <code>Subject</code>, or
those added by other <code>LoginModule</code>s.</p>

<p>If the <code>Subject</code> has been marked <i>read-only</i>
(the <code>Subject</code>'s <code>isReadOnly</code> method
returns <i>true</i>), then this method should only destroy
credentials associated with the <code>Subject</code> during the
<code>commit</code> operation (removing the credentials is not
possible). If the <code>Subject</code> has been marked as
<i>read-only</i> and the credentials associated with the
<code>Subject</code> during the <code>commit</code> operation are
not destroyable (they do not implement the
<code>Destroyable</code> interface), then this method may throw a
<code>LoginException</code>.</p>

<p>The <code>logout</code> method should return <code>true</code>
if logout succeeds, or otherwise throw a LoginException.</p>

<!-- ******************************************************************* -->

<h3><a name="Step_4">Step 4: Choose or Write a Sample
Application</a></h3>

<p>Either choose an existing sample application for your testing,
or write a new one. See <a href="JAASRefGuide.html">JAAS
Reference Guide</a> for information about application
requirements and a sample application you can use for your
testing.</p>

<!-- ******************************************************************* -->

<h3><a name="Step_5">Step 5: Compile the <code>LoginModule</code>
and Application</a></h3>

<p>Compile your new <code>LoginModule</code> and the application you
will use for testing.</p> 

<!-- ******************************************************************* -->

<h3><a name="Step_6">Step 6: Prepare for Testing</a></h3>

<!-- ******************************************************************* -->

<h4><a name="Step_6a">Step 6a: Place Your
<code>LoginModule</code> and Application Code in JAR
Files</a></h4>

<p>Place your <code>LoginModule</code> and application code in
separate JAR files, in preparation for referencing the JAR files
in the policy in <a href="#Step_6c">Step 6c</a>. Here is a sample
command for creating a JAR file:</p>

<pre>
jar cvf &lt;JAR file name&gt; &lt;list of classes, separated by spaces&gt;
</pre>

<p>This command creates a JAR file with the specified name
containing the specified classes.</p>

<p>For more information on the <b>jar</b> tool, see <b>jar</b>
(<a href="../../../tools/unix/jar.html">for Solaris, Linux,
or Mac OS X</a>) (<a
href="../../../tools/windows/jar.html">for Microsoft
Windows</a>).</p>

<!-- ******************************************************************* -->

<h4><a name="Step_6b">Step 6b: Decide Where to Store the JAR
Files</a></h4>

<p>The application can be stored essentially anywhere you
like.</p>

<p>Your <code>LoginModule</code> can also be placed anywhere you
(and other clients) like. If the <code>LoginModule</code> is
fully trusted, it can be placed in the JRE's <code>lib/ext</code>
(standard extension) directory.</p>

<p>You will need to test the <code>LoginModule</code> being
located both in the <code>lib/ext</code> directory and elsewhere
because in one situation your <code>LoginModule</code> will need
to explicitly be granted <a href=
"../permissions.html">permissions</a> required for any
security-sensitive operations it does, while in the other case
such permissions are not needed.</p>

<p>If your <code>LoginModule</code> is placed in the JRE's
<code>lib/ext</code> directory, it will be treated as an
installed extension and no permissions need to be granted, since
the default system <a href="../PolicyFiles.html">policy file</a>
grants all permissions to installed extensions.</p>

<p>If your <code>LoginModule</code> is placed anywhere else, the
permissions need to be granted, for example by <code>grant</code>
statements in a policy file.</p>

<p>Decide where you will store the <code>LoginModule</code> JAR
file for testing the case where it is not an installed extension.
In the next step, you grant permissions to the JAR file, in the
specified location.</p>

<!-- ******************************************************************* -->

<h4><a name="Step_6c">Step 6c: Set <code>LoginModule</code> and
Application JAR File Permissions</a></h4>

<p>If your <code>LoginModule</code> and/or application performs
security-sensitive tasks that will trigger security checks
(making network connections, reading or writing files on a local
disk, etc), it will need to be granted the required <a href=
"../permissions.html">permissions</a> if it is not an installed
extension (see <a href="#Step_6b">Step 6b</a>) and it is run
while a security manager is installed.</p>

<p>Since <code>LoginModule</code>s usually associate
<code>Principal</code>s and credentials with an authenticated
Subject, some types of permissions a <code>LoginModule</code>
will typically require are <a href=
"../../../../api/javax/security/auth/AuthPermission.html">AuthPermission</a>s
with target names "modifyPrincipals", "modifyPublicCredentials",
and "modifyPrivateCredentials".</p>

<p>A sample statement granting permissions to a
<code>LoginModule</code> whose code is in <code>MyLM.jar</code>
appears below. Such a statement could appear in a policy file. In
this example, the <code>MyLM.jar</code> file is assumed to be in
the <code>/localWork</code> directory.</p>

<pre>
grant codeBase "file:/localWork/MyLM.jar" {
  permission javax.security.auth.AuthPermission "modifyPrincipals";
  permission javax.security.auth.AuthPermission "modifyPublicCredentials";
  permission javax.security.auth.AuthPermission "modifyPrivateCredentials";
};
</pre>

<p>Note: Since a <code>LoginModule</code> is always invoked
within an <code>AccessController.doPrivileged</code> call, it
should not have to call <code>doPrivileged</code> itself. If it
does, it may inadvertently open up a security hole. For example,
a <code>LoginModule</code> that invokes the application-provided
<code>CallbackHandler</code> inside a <code>doPrivileged</code>
call opens up a security hole by permitting the application's
<code>CallbackHandler</code> to gain access to resources it would
otherwise not have been able to access.</p>

<!-- ******************************************************************* -->

<h4><a name="Step_6d">Step 6d: Create a Configuration Referencing
the LoginModule</a></h4>

<p>Because JAAS supports a pluggable authentication architecture,
your new <code>LoginModule</code> can be used without requiring
modifications to existing applications. Only the login
<code>Configuration</code> needs to be updated in order to
indicate use of a new <code>LoginModule</code>.</p>

<p>The default <code>Configuration</code> implementation from Oracle reads configuration information from configuration
files, as described in <a href=
"../../../../jre/api/security/jaas/spec/com/sun/security/auth/login/ConfigFile.html">
com.sun.security.auth.login.ConfigFile.html</a>.</p>

<p>Create a configuration file to be used for testing. For
example, to configure the previously-mentioned hypothetical IBM
<code>LoginModule</code> for an application, the configuration
file might look like this:</p>

<pre>
    AppName {
        com.ibm.auth.Module REQUIRED debug=true;
    };
</pre>

<p>where <code>AppName</code> should be whatever name the
application uses to refer to this entry in the login
configuration file. The application specifies this name as the
first argument to the <code>LoginContext</code> constructor.</p> 

<!-- ******************************************************************* -->

<h3><a name="Step_7">Step 7: Test Use of the
<code>LoginModule</code></a></h3>

<p>Finally, test your application and its use of the
<code>LoginModule</code>. When you run the application, specify
the login configuration file to be used. For example, suppose
your application is named <code>MyApp</code>, it is located in
<code>MyApp.jar</code>, and your configuration file is
<code>test.conf</code>. You could run the application and specify
the configuration file via the following:</p>

<pre>
java -classpath MyApp.jar
 -Djava.security.auth.login.config=test.conf MyApp
</pre>

<p>Type all that on one line. Multiple lines are used here for
legibility.</p>

<p>To specify a policy file named <code>my.policy</code> and run
the application with a security manager installed, do the
following:</p>

<pre>
java -classpath MyApp.jar -Djava.security.manager
 -Djava.security.policy=my.policy
 -Djava.security.auth.login.config=test.conf MyApp
</pre>

<p>Again, type all that on one line.</p>

<p>You may want to configure the <code>LoginModule</code> with a
<i>debug</i> option to help ensure that it is working
correctly.</p>

<p>Debug your code and continue testing as needed. If you have
problems, review the steps above and ensure they are all
completed.</p>

<p>Be sure to vary user input and the <code>LoginModule</code>
options specified in the configuration file.</p>

<p>Be sure to also include testing using different installation
options (e.g., making the <code>LoginModule</code> an installed
extension or placing it on the class path) and execution
environments (with or without a security manager running).
Installation options are discussed in <a href="#Step_6b">Step
6b</a>. In particular, in order to ensure your
<code>LoginModule</code> works when a security manager is
installed and the <code>LoginModule</code> and application are
not installed extensions, you need to test such an installation
and execution environment, after granting required permissions,
as described in <a href="#Step_6c">Step 6c</a>.</p>

<p>If you find during testing that your <code>LoginModule</code>
or application needs modifications, make the modifications,
recompile (<a href="#Step_5">Step 5</a>), place the updated code
in a JAR file (<a href="#Step_6a">Step 6a</a>), re-install the
JAR file (<a href="#Step_6b">Step 6b</a>), if needed fix or add
to the permissions (<a href="#Step_6c">Step 6c</a>), if needed
modify the login configuration file (<a href="#Step_6d">Step
6d</a>), and then re-run the application and repeat these steps
as needed.</p>

<!-- ******************************************************************* -->

<h3><a name="Step_8">Step 8: Document Your
<code>LoginModule</code> Implementation</a></h3>

<p>The next step is to write documentation for clients of your
<code>LoginModule</code>. Example documentation you may want to
include is:</p>

<ul>
<li>A README or User Guide describing 

<ul>
<li>the authentication process employed by your
<code>LoginModule</code> implementation.</li>

<li>information on how to install the
<code>LoginModule</code>.</li>

<li>configuration options accepted by the
<code>LoginModule</code>. For each option, specify the option
name and possible values (or types of values), as well as the
behavior the option controls.</li>

<li>the permissions required by your <code>LoginModule</code>
when it is run with a security manager (and it is not an
installed extension).</li>
</ul>
</li>

<li>An example <code>Configuration</code> file that references
your new <code>LoginModule</code>.</li>

<li>An example policy file granting your <code>LoginModule</code>
the required permissions.</li>

<li>API documentation. Putting <b>javadoc</b> comments into your
source code as you write it will make the API javadocs easy to
generate.</li>
</ul>

<!-- ******************************************************************* -->

<h3><a name="Step_9">Step 9: Make <code>LoginModule</code> JAR
File and Documents Available</a></h3>

<p>The final step is to make your <code>LoginModule</code> JAR
file and documentation available to clients.</p>

<!--  footer start -->
<div id="javasefooter">
<div class="hr">
<hr /></div>
<div id="javasecopyright">
<img id="oraclelogofooter" src=
"../../../../images/oraclelogo.gif" alt="Oracle and/or its affiliates"
border="0" width="100" height="29" name=
"oraclelogofooter" />

<a href="../../../../legal/cpyr.html">Copyright
&#169;</a> 1993, 2018, Oracle and/or its affiliates. All rights
reserved.</div>
<div id="javasecontactus">
<a href=
"http://docs.oracle.com/javase/feedback.html">Contact
Us</a>
</div>
</div>
<!-- footer end -->

<!-- STATIC FOOTER -->

</body>
</html>


