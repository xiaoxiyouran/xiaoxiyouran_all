<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xml:lang=
"en-US">
<head>
<meta http-equiv="Content-Type" content=
"text/html; charset=utf-8" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<title>Java XML Digital Signature API</title>
<meta name="collection" content="reference" />
<link rel="stylesheet" type="text/css" href="../../../../technotes/css/guide.css" />
</head>
<body>
<!-- STATIC HEADER -->

<!-- header start -->
<div id="javaseheader">
<div id="javaseheaderlogo">
<img src="../../../../images/javalogo.gif"
alt="Java logo" />
</div>
<div id="javaseheaderindex">

<a href=
"../../../../index.html">Documentation Contents</a>
</div>
<div class="clear"></div>
</div>

<!-- header end -->



<h1>XML Digital Signature API</h1>
<h2>Overview and Tutorial</h2>


<h2>Table of Contents</h2>

<h3><a href="#wp268799">Java XML Digital Signature API</a></h3>
<h3><a href="#wp510709">Package Hierarchy</a></h3>
<h3><a href="#wp510726">Service Providers</a></h3>
<h3><a href="#wp510728">Introduction to XML Signatures</a></h3>
<h3><a href="#wp511122">Example of an XML Signature</a></h3>
<h3><a href="#wp511406">XML Digital Signature API Examples</a></h3>
<p class="pBody"><a href="#wp511427">validate Example</a></p>
<p class="pBody"><a href="#wp512158">Validating an XML
Signature</a></p>
<p class="pBody"><a href="#wp511408">Instantiating the Document
that Contains the Signature</a></p>
<p class="pBody"><a href="#wp511502">Specifying the Signature
Element to be Validated</a></p>
<p class="pBody"><a href="#wp511504">Creating a Validation
Context</a></p>
<p class="pBody"><a href="#wp511418">Unmarshaling the XML
Signature</a></p>
<p class="pBody"><a href="#wp511420">Validating the XML
Signature</a></p>
<p class="pBody"><a href="#wp511422">What If the XML Signature
Fails to Validate?</a></p>
<p class="pBody"><a href="#wp511424">Using KeySelectors</a></p>
<p class="pBody"><a href="#wp511438">genenveloped Example</a></p>
<p class="pBody"><a href="#wp511436">Generating an XML
Signature</a></p>
<p class="pBody"><a href="#wp511741">Instantiating the Document to
be Signed</a></p>
<p class="pBody"><a href="#wp511743">Creating a Public Key
Pair</a></p>
<p class="pBody"><a href="#wp511745">Creating a Signing
Context</a></p>
<p class="pBody"><a href="#wp511747">Assembling the XML
Signature</a></p>
<p class="pBody"><a href="#wp511749">Generating the XML
Signature</a></p>
<p class="pBody"><a href="#wp511751">Printing or Displaying the
Resulting Document</a></p>
<hr />
<!-- **** end table of contents **** -->
<a name="wp268799" id="wp268799"></a>
<h2 class="pTitle">Java XML Digital Signature API</h2>
<a name="wp510622" id="wp510622"></a>
<p class="pBody">The Java XML Digital Signature API is a standard
Java API for generating and validating XML Signatures. This API was
defined under the Java Community Process as JSR 105 (see
<code class="cCode"><a href=
"http://www.jcp.org/en/jsr/detail?id=105" target=
"_blank">http://jcp.org/en/jsr/detail?id=105</a></code>).</p>
<a name="wp510624" id="wp510624"></a>
<p class="pBody">XML Signatures can be applied to data of any type,
XML or binary (see <code class="cCode"><a href=
"http://www.w3.org/TR/xmldsig-core/" target=
"_blank">http://www.w3.org/TR/xmldsig-core/</a></code>). The
resulting signature is represented in XML. An XML Signature can be
used to secure your data and provide data integrity, message
authentication, and signer authentication.</p>
<a name="wp268803" id="wp268803"></a>
<p class="pBody">After providing a brief overview of XML Signatures
and the XML Digital Signature API, this document presents two
examples that demonstrate how to use the API to validate and
generate an XML Signature. This document assumes that you have a
basic knowledge of cryptography and digital signatures.</p>
<a name="wp510648" id="wp510648"></a>
<p class="pBody">The API is designed to support all of the required
or recommended features of the W3C Recommendation for XML-Signature
Syntax and Processing. The API is extensible and pluggable and is
based on the Java Cryptography Service Provider Architecture. The
API is designed for two types of developers:</p>
<div class="pSmartList1">
<div style="margin-left: 2em" class="pSmartList1"><a name=
"wp510650" id="wp510650"></a>
<div class="pSmartList1">
<ul>
<li>Developers who want to use the XML Digital Signature API to
generate and validate XML signatures</li>
</ul>
</div>
<a name="wp510651" id="wp510651"></a>
<div class="pSmartList1">
<ul>
<li>Developers who want to create a concrete implementation of the
XML Digital Signature API and register it as a cryptographic
service of a <code class="cCode"><a href=
"../crypto/CryptoSpec.html#Provider" target="_blank">JCA
provider</a></code></li>
</ul>
</div>
</div>
</div>
<a name="wp510690" id="wp510690"></a>
<p class="pBody"><!-- broken link <a  href="#wp510707"> -->
 <a name="wp510709" id="wp510709"></a></p>
<h2 class="pHeading1">Package Hierarchy</h2>
<a name="wp510735" id="wp510735"></a>
<p class="pBody">The six packages listed below comprise the XML
Digital Signature API:</p>
<div class="pSmartList1">
<div style="margin-left: 2em" class="pSmartList1"><a name=
"wp510737" id="wp510737"></a>
<div class="pSmartList1">
<ul>
<li><code class="cCode">javax.xml.crypto</code></li>
</ul>
</div>
<a name="wp510738" id="wp510738"></a>
<div class="pSmartList1">
<ul>
<li><code class="cCode">javax.xml.crypto.dsig</code></li>
</ul>
</div>
<a name="wp510739" id="wp510739"></a>
<div class="pSmartList1">
<ul>
<li><code class="cCode">javax.xml.crypto.dsig.keyinfo</code></li>
</ul>
</div>
<a name="wp510740" id="wp510740"></a>
<div class="pSmartList1">
<ul>
<li><code class="cCode">javax.xml.crypto.dsig.spec</code></li>
</ul>
</div>
<a name="wp510741" id="wp510741"></a>
<div class="pSmartList1">
<ul>
<li><code class="cCode">javax.xml.crypto.dom</code></li>
</ul>
</div>
<a name="wp510742" id="wp510742"></a>
<div class="pSmartList1">
<ul>
<li><code class="cCode">javax.xml.crypto.dsig.dom</code></li>
</ul>
</div>
</div>
</div>
<a name="wp510744" id="wp510744"></a>
<p class="pBody">The <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/package-summary.html" target=
"_blank">javax.xml.crypto</a></code> package contains common
classes that are used to perform XML cryptographic operations, such
as generating an XML signature or encrypting XML data. Two notable
classes in this package are the <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/KeySelector.html" target=
"_blank">KeySelector</a></code> class, which allows developers to
supply implementations that locate and optionally validate keys
using the information contained in a <code class=
"cCode">KeyInfo</code> object, and the <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/URIDereferencer.html" target=
"_blank">URIDereferencer</a></code> class, which allows developers
to create and specify their own URI dereferencing
implementations.</p>
<a name="wp510746" id="wp510746"></a>
<p class="pBody">The <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/package-summary.html"
target="_blank">javax.xml.crypto.dsig</a></code> package includes
interfaces that represent the core elements defined in the W3C XML
digital signature specification. Of primary significance is the
<code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/XMLSignature.html" target=
"_blank">XMLSignature</a></code> class, which allows you to sign
and validate an XML digital signature. Most of the XML signature
structures or elements are represented by a corresponding interface
(except for the <code class="cCode">KeyInfo</code> structures,
which are included in their own package and are discussed in the
next paragraph). These interfaces include: <code class=
"cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/SignedInfo.html" target=
"_blank">SignedInfo</a></code>, <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/CanonicalizationMethod.html"
target="_blank">CanonicalizationMethod</a></code>, <code class=
"cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/SignatureMethod.html"
target="_blank">SignatureMethod</a></code>, <code class=
"cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/Reference.html" target=
"_blank">Reference</a></code>, <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/Transform.html" target=
"_blank">Transform</a></code>, <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/DigestMethod.html" target=
"_blank">DigestMethod</a></code>, <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/XMLObject.html" target=
"_blank">XMLObject</a></code>, <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/Manifest.html" target=
"_blank">Manifest</a></code>, <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/SignatureProperty.html"
target="_blank">SignatureProperty</a></code>, and <code class=
"cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/SignatureProperties.html"
target="_blank">SignatureProperties</a></code>. The <code class=
"cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/XMLSignatureFactory.html"
target="_blank">XMLSignatureFactory</a></code> class is an abstract
factory that is used to create objects that implement these
interfaces.</p>
<a name="wp510748" id="wp510748"></a>
<p class="pBody">The <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/keyinfo/package-summary.html"
target="_blank">javax.xml.crypto.dsig.keyinfo</a></code> package
contains interfaces that represent most of the <code class=
"cCode">KeyInfo</code> structures defined in the W3C XML digital
signature recommendation, including <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/keyinfo/KeyInfo.html"
target="_blank">KeyInfo</a></code>, <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/keyinfo/KeyName.html"
target="_blank">KeyName</a></code>, <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/keyinfo/KeyValue.html"
target="_blank">KeyValue</a></code>, <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/keyinfo/X509Data.html"
target="_blank">X509Data</a></code>, <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/keyinfo/X509IssuerSerial.html"
target="_blank">X509IssuerSerial</a></code>, <code class=
"cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/keyinfo/RetrievalMethod.html"
target="_blank">RetrievalMethod</a></code>, and <code class=
"cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/keyinfo/PGPData.html"
target="_blank">PGPData</a></code>. The <code class=
"cCode"><a href="../../../../api/javax/xml/crypto/dsig/keyinfo/KeyInfoFactory.html"
target="_blank">KeyInfoFactory</a></code> class is an abstract
factory that is used to create objects that implement these
interfaces.</p>
<a name="wp510750" id="wp510750"></a>
<p class="pBody">The <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/spec/package-summary.html"
target="_blank">javax.xml.crypto.dsig.spec</a></code> package
contains interfaces and classes representing input parameters for
the digest, signature, transform, or canonicalization algorithms
used in the processing of XML signatures.</p>
<a name="wp510725" id="wp510725"></a>
<p class="pBody">Finally, the <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dom/package-summary.html" target=
"_blank">javax.xml.crypto.dom</a></code> and <code class=
"cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/dom/package-summary.html"
target="_blank">javax.xml.crypto.dsig.dom</a></code> packages
contains DOM-specific classes for the <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/package-summary.html" target=
"_blank">javax.xml.crypto</a></code> and <code class=
"cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/package-summary.html"
target="_blank">javax.xml.crypto.dsig</a></code> packages,
respectively. Only developers and users who are creating or using a
DOM-based <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/XMLSignatureFactory.html"
target="_blank">XMLSignatureFactory</a></code> or <code class=
"cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/keyinfo/KeyInfoFactory.html"
target="_blank">KeyInfoFactory</a></code> implementation will need
to make direct use of these packages.</p>
<!-- *****api file 5 ***** -->
<a name="wp510726" id="wp510726"></a>
<h2 class="pHeading1">Service Providers</h2>
<a name="wp510760" id="wp510760"></a>
<p class="pBody">A JSR 105 cryptographic service is a concrete
implementation of the abstract <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/XMLSignatureFactory.html"
target="_blank">XMLSignatureFactory</a></code> and <code class=
"cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/keyinfo/KeyInfoFactory.html"
target="_blank">KeyInfoFactory</a></code> classes and is
responsible for creating objects and algorithms that parse,
generate and validate XML Signatures and <code class=
"cCode">KeyInfo</code> structures. A concrete implementation of
<code class="cCode">XMLSignatureFactory</code> <em class=
"cEmphasis">must</em> provide support for each of the <em class=
"cEmphasis">required</em> algorithms as specified by the W3C
recommendation for XML Signatures. It can optionally support other
algorithms as defined by the W3C recommendation or other
specifications.</p>
<a name="wp510762" id="wp510762"></a>
<p class="pBody">JSR 105 leverages the JCA provider model for
registering and loading <code class=
"cCode">XMLSignatureFactory</code> and <code class=
"cCode">KeyInfoFactory</code> implementations.</p>
<a name="wp510764" id="wp510764"></a>
<p class="pBody">Each concrete <code class=
"cCode">XMLSignatureFactory</code> or <code class=
"cCode">KeyInfoFactory</code> implementation supports a specific
XML mechanism type that identifies the XML processing mechanism
that an implementation uses internally to parse and generate XML
signature and <code class="cCode">KeyInfo</code> structures. This
JSR supports one standard type, DOM. The XML Digital Signature
provider implementation that is bundled with Java SE supports the
DOM mechanism. Support for new standard types, such as JDOM, may be
added in the future.</p>
<a name="wp513449" id="wp513449"></a>
<p class="pBody">An XML Digital Signature API implementation
<em class="cEmphasis">should</em> use underlying JCA engine
classes, such as <code class="cCode"><a href=
"../../../../api/java/security/Signature.html" target=
"_blank">java.security.Signature</a></code> and <code class=
"cCode"><a href="../../../../api/java/security/MessageDigest.html"
target="_blank">java.security.MessageDigest</a></code>, to perform
cryptographic operations.</p>
<a name="wp513458" id="wp513458"></a>
<p class="pBody">In addition to the <code class=
"cCode">XMLSignatureFactory</code> and <code class=
"cCode">KeyInfoFactory</code> classes, JSR 105 supports a service
provider interface for transform and canonicalization algorithms.
The <code class="cCode"><a href=
"../../../../api/javax/xml/crypto/dsig/TransformService.html"
target="_blank">TransformService</a></code> class allows you to
develop and plug in an implementation of a specific transform or
canonicalization algorithm for a particular XML mechanism type. The
<code class="cCode">TransformService</code> class uses the standard
JCA provider model for registering and loading implementations.
Each JSR 105 implementation <em class="cEmphasis">should</em> use
the <code class="cCode">TransformService</code> class to find a
provider that supports transform and canonicalization algorithms in
XML Signatures that it is generating or validating.</p>
<!-- *****api file 6 ***** -->
<a name="wp510728" id="wp510728"></a>
<h2 class="pHeading1">Introduction to XML Signatures</h2>
<a name="wp511121" id="wp511121"></a>
<p class="pBody">You can use an XML Signature to sign any arbitrary
data, whether it is XML or binary. The data is identified via URIs
in one or more Reference elements. XML Signatures are described in
one or more of three forms: detached, enveloping, or enveloped. A
detached signature is over data that is external, or outside of the
signature element itself. Enveloping signatures are signatures over
data that is inside the signature element, and an enveloped
signature is a signature that is contained inside the data that it
is signing.</p>
<!-- *****api file 7 ***** -->
<a name="wp511122" id="wp511122"></a>
<h2 class="pHeading1">Example of an XML Signature</h2>
<a name="wp511141" id="wp511141"></a>
<p class="pBody">The easiest way to describe the contents of an XML
Signature is to show an actual sample and describe each component
in more detail. The following is an example of an enveloped XML
Signature generated over the contents of an XML document. The
contents of the document before it is signed are:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
&lt;Envelope xmlns=&quot;urn:envelope&quot;&gt;
&lt;/Envelope&gt;<a name="wp511143" id="wp511143"> </a>
</pre></div>
<a name="wp511146" id="wp511146"></a>
<p class="pBody">The resulting enveloped XML Signature, indented
and formatted for readability, is as follows:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;Envelope xmlns=&quot;urn:envelope&quot;&gt;
  &lt;Signature xmlns=&quot;http://www.w3.org/2000/09/xmldsig#&quot;&gt;
    &lt;SignedInfo&gt;
      &lt;CanonicalizationMethod 
        Algorithm=&quot;http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments&quot;/&gt;
      &lt;SignatureMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#dsa-sha1&quot;/&gt;
      &lt;Reference URI=&quot;&quot;&gt;
        &lt;Transforms&gt;
          &lt;Transform Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&quot;/&gt;
        &lt;/Transforms&gt;
        &lt;DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;/&gt;
        &lt;DigestValue&gt;uooqbWYa5VCqcJCbuymBKqm17vY=&lt;/DigestValue&gt;
      &lt;/Reference&gt;
    &lt;/SignedInfo&gt;
    &lt;SignatureValue&gt;
      KedJuTob5gtvYx9qM3k3gm7kbLBwVbEQRl26S2tmXjqNND7MRGtoew==
    &lt;/SignatureValue&gt;
    &lt;KeyInfo&gt;
      &lt;KeyValue&gt;
        &lt;DSAKeyValue&gt;
          &lt;P&gt;
            /KaCzo4Syrom78z3EQ5SbbB4sF7ey80etKII864WF64B81uRpH5t9jQTxe
            Eu0ImbzRMqzVDZkVG9xD7nN1kuFw==
          &lt;/P&gt;
          &lt;Q&gt;li7dzDacuo67Jg7mtqEm2TRuOMU=&lt;/Q&gt;
          &lt;G&gt;
            Z4Rxsnqc9E7pGknFFH2xqaryRPBaQ01khpMdLRQnG541Awtx/
            XPaF5Bpsy4pNWMOHCBiNU0NogpsQW5QvnlMpA==
          &lt;/G&gt;
          &lt;Y&gt;
            qV38IqrWJG0V/mZQvRVi1OHw9Zj84nDC4jO8P0axi1gb6d+475yhMjSc/
            BrIVC58W3ydbkK+Ri4OKbaRZlYeRA==
          &lt;/Y&gt;
        &lt;/DSAKeyValue&gt;
      &lt;/KeyValue&gt;
    &lt;/KeyInfo&gt;
  &lt;/Signature&gt;
&lt;/Envelope&gt;<a name="wp511148" id="wp511148"> </a>
</pre></div>
<a name="wp511183" id="wp511183"></a>
<p class="pBody">The <code class="cCode">Signature</code> element
has been inserted inside the content that it is signing, thereby
making it an enveloped signature. The required <code class=
"cCode">SignedInfo</code> element contains the information that is
actually signed:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
&lt;SignedInfo&gt;
  &lt;CanonicalizationMethod 
    Algorithm=&quot;http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments&quot;/&gt;
  &lt;SignatureMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#dsa-sha1&quot;/&gt;
  &lt;Reference URI=&quot;&quot;&gt;
    &lt;Transforms&gt;
      &lt;Transform Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#enveloped-signature&quot;/&gt;
    &lt;/Transforms&gt;
    &lt;DigestMethod Algorithm=&quot;http://www.w3.org/2000/09/xmldsig#sha1&quot;/&gt;
    &lt;DigestValue&gt;uooqbWYa5VCqcJCbuymBKqm17vY=&lt;/DigestValue&gt;
  &lt;/Reference&gt;
&lt;/SignedInfo&gt;<a name="wp511185" id="wp511185"> </a>
</pre></div>
<a name="wp511204" id="wp511204"></a>
<p class="pBody">The required <code class=
"cCode">CanonicalizationMethod</code> element defines the algorithm
used to canonicalize the <code class="cCode">SignedInfo</code>
element before it is signed or validated. Canonicalization is the
process of converting XML content to a canonical form, to take into
account changes that can invalidate a signature over that data.
Canonicalization is necessary due to the nature of XML and the way
it is parsed by different processors and intermediaries, which can
change the data such that the signature is no longer valid but the
signed data is still logically equivalent.</p>
<a name="wp511206" id="wp511206"></a>
<p class="pBody">The required <code class=
"cCode">SignatureMethod</code> element defines the digital
signature algorithm used to generate the signature, in this case
DSA with SHA-1.</p>
<a name="wp511208" id="wp511208"></a>
<p class="pBody">One or more <code class="cCode">Reference</code>
elements identify the data that is digested. Each <code class=
"cCode">Reference</code> element identifies the data via a URI. In
this example, the value of the URI is the empty String
(&quot;&quot;), which indicates the root of the document. The
optional <code class="cCode">Transforms</code> element contains a
list of one or more <code class="cCode">Transform</code> elements,
each of which describes a transformation algorithm used to
transform the data before it is digested. In this example, there is
one <code class="cCode">Transform</code> element for the enveloped
transform algorithm. The enveloped transform is required for
enveloped signatures so that the signature element itself is
removed before calculating the signature value. The required
<code class="cCode">DigestMethod</code> element defines the
algorithm used to digest the data, in this case SHA1. Finally the
required <code class="cCode">DigestValue</code> element contains
the actual base64-encoded digested value.</p>
<a name="wp511210" id="wp511210"></a>
<p class="pBody">The required <code class=
"cCode">SignatureValue</code> element contains the base64-encoded
signature value of the signature over the <code class=
"cCode">SignedInfo</code> element.</p>
<a name="wp511252" id="wp511252"></a>
<p class="pBody">The optional <code class="cCode">KeyInfo</code>
element contains information about the key that is needed to
validate the signature:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
&lt;KeyInfo&gt;
  &lt;KeyValue&gt;
    &lt;DSAKeyValue&gt;
      &lt;P&gt;
        /KaCzo4Syrom78z3EQ5SbbB4sF7ey80etKII864WF64B81uRpH5t9jQTxe
        Eu0ImbzRMqzVDZkVG9xD7nN1kuFw==
      &lt;/P&gt;
      &lt;Q&gt;li7dzDacuo67Jg7mtqEm2TRuOMU=&lt;/Q&gt;
      &lt;G&gt;
        Z4Rxsnqc9E7pGknFFH2xqaryRPBaQ01khpMdLRQnG541Awtx/
        XPaF5Bpsy4pNWMOHCBiNU0NogpsQW5QvnlMpA==
      &lt;/G&gt;
      &lt;Y&gt;
        qV38IqrWJG0V/mZQvRVi1OHw9Zj84nDC4jO8P0axi1gb6d+475yhMjSc/
        BrIVC58W3ydbkK+Ri4OKbaRZlYeRA==
      &lt;/Y&gt;
    &lt;/DSAKeyValue&gt;
  &lt;/KeyValue&gt;
&lt;/KeyInfo&gt;<a name="wp511374" id="wp511374"> </a>
</pre></div>
<a name="wp511202" id="wp511202"></a>
<p class="pBody">This <code class="cCode">KeyInfo</code> element
contains a <code class="cCode">KeyValue</code> element, which in
turn contains a <code class="cCode">DSAKeyValue</code> element
consisting of the public key needed to validate the signature.
<code class="cCode">KeyInfo</code> can contain various content such
as X.509 certificates and PGP key identifiers. See the <code class=
"cCode"><a href="http://www.w3.org/TR/xmldsig-core/#sec-KeyInfo"
target="_blank">KeyInfo section</a></code> of the XML Signature
Recommendation for more information on the different <code class=
"cCode">KeyInfo</code> types.</p>
<!-- *****api file 8 ***** -->
<a name="wp511406" id="wp511406"></a>
<h2 class="pHeading1">XML Digital Signature API Examples</h2>
<a name="wp511426" id="wp511426"></a>
<p class="pBody">The following sections describe two examples that
show how to use the XML Digital Signature API:</p>
<div class="pSmartList1">
<div style="margin-left: 2em" class="pSmartList1"><a name=
"wp511432" id="wp511432"></a>
<div class="pSmartList1">
<ul>
<li>Validate example</li>
</ul>
</div>
<a name="wp511433" id="wp511433"></a>
<div class="pSmartList1">
<ul>
<li>Signing example</li>
</ul>
</div>
</div>
</div>
<a name="wp511427" id="wp511427"></a>
<h3 class="pHeading2">validate Example</h3>
<a name="wp512156" id="wp512156"></a>
<p class="pBody">You can find the code shown in this section in the
<code class="cCode">Validate.java</code> file in the 
<!-- <code class="cVariable">JWSDP_HOME</code> --> <code class=
"cCode">docs/technotes/guides/security/xmldsig</code> directory.
The file on which it operates, <code class=
"cCode">envelopedSignature.xml</code>, is in the same
directory.</p>
<a name="wp512164" id="wp512164"></a>
<p class="pBody">To compile and run the example, execute the
following commands from the <code class=
"cVariable">docs/technotes/guides/security/xmldsig</code>
directory:<br />
<br />
<code>$ javac Validate.java<br />
$ java Validate signature.xml<br /></code></p>
The sample program will validate the signature in the file
<code>signature.xml</code> in the current working directory. 
 <a name="wp512158" id="wp512158"></a>
<h4 class="pHeading3">Validating an XML Signature</h4>
<a name="wp511454" id="wp511454"></a>
<p class="pBody">This example shows you how to validate an XML
Signature using the JSR 105 API. The example uses DOM (the Document
Object Model) to parse an XML document containing a Signature
element and a JSR 105 DOM implementation to validate the
signature.</p>
<a name="wp511408" id="wp511408"></a>
<h4 class="pHeading3">Instantiating the Document that Contains the
Signature</h4>
<a name="wp511458" id="wp511458"></a>
<p class="pBody">First we use a JAXP <code class=
"cCode">DocumentBuilderFactory</code> to parse the XML document
containing the Signature. An application obtains the default
implementation for <code class=
"cCode">DocumentBuilderFactory</code> by calling the following line
of code:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
DocumentBuilderFactory dbf = 
&nbsp;&nbsp;DocumentBuilderFactory.newInstance();<a name="wp511460"
id="wp511460"> </a>
</pre></div>
<a name="wp511462" id="wp511462"></a>
<p class="pBody">We must also make the factory namespace-aware:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
dbf.setNamespaceAware(true);<a name="wp511464" id="wp511464"> </a>
</pre></div>
<a name="wp511466" id="wp511466"></a>
<p class="pBody">Next, we use the factory to get an instance of a
<code class="cCode">DocumentBuilder</code>, which is used to parse
the document:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
DocumentBuilder builder = dbf.newDocumentBuilder();  
Document doc = builder.parse(new FileInputStream(argv[0]));<a name=
"wp511468" id="wp511468"> </a>
</pre></div>
<a name="wp511502" id="wp511502"></a>
<h4 class="pHeading3">Specifying the Signature Element to be
Validated</h4>
<a name="wp511508" id="wp511508"></a>
<p class="pBody">We need to specify the <code class=
"cCode">Signature</code> element that we want to validate, since
there could be more than one in the document. We use the DOM method
<code class="cCode">Document.getElementsByTagNameNS</code>, passing
it the XML Signature namespace URI and the tag name of the
<code class="cCode">Signature</code> element, as shown:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
NodeList nl = doc.getElementsByTagNameNS
&nbsp;&nbsp;(XMLSignature.XMLNS, &quot;Signature&quot;);
if (nl.getLength() == 0) {
&nbsp;&nbsp;throw new Exception(&quot;Cannot find Signature element&quot;);
}<a name="wp511510" id="wp511510"> </a>
</pre></div>
<a name="wp511503" id="wp511503"></a>
<p class="pBody">This returns a list of all <code class=
"cCode">Signature</code> elements in the document. In this example,
there is only one <code class="cCode">Signature</code> element.</p>
<a name="wp511504" id="wp511504"></a>
<h4 class="pHeading3">Creating a Validation Context</h4>
<a name="wp511524" id="wp511524"></a>
<p class="pBody">We create an <code class=
"cCode">XMLValidateContext</code> instance containing input
parameters for validating the signature. Since we are using DOM, we
instantiate a <code class="cCode">DOMValidateContext</code>
instance (a subclass of <code class=
"cCode">XMLValidateContext</code>), and pass it two parameters, a
<code class="cCode">KeyValueKeySelector</code> object and a
reference to the <code class="cCode">Signature</code> element to be
validated (which is the first entry of the <code class=
"cCode">NodeList</code> we generated earlier):</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
DOMValidateContext valContext = new DOMValidateContext
&nbsp;&nbsp;(new KeyValueKeySelector(), nl.item(0));<a name=
"wp511526" id="wp511526"> </a>
</pre></div>
<a name="wp511529" id="wp511529"></a>
<p class="pBody">The <code class="cCode">KeyValueKeySelector</code>
is explained in greater detail in <a href="#wp511424">Using
KeySelectors</a>.</p>
<a name="wp511418" id="wp511418"></a>
<h4 class="pHeading3">Unmarshaling the XML Signature</h4>
<a name="wp511539" id="wp511539"></a>
<p class="pBody">We extract the contents of the <code class=
"cCode">Signature</code> element into an <code class=
"cCode">XMLSignature</code> object. This process is called
unmarshalling. The <code class="cCode">Signature</code> element is
unmarshalled using an <code class=
"cCode">XMLSignatureFactory</code> object. An application can
obtain a DOM implementation of <code class=
"cCode">XMLSignatureFactory</code> by calling the following line of
code:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
XMLSignatureFactory factory = 
&nbsp;&nbsp;XMLSignatureFactory.getInstance(&quot;DOM&quot;);<a name="wp511541"
id="wp511541"> </a>
</pre></div>
<a name="wp511543" id="wp511543"></a>
<p class="pBody">We then invoke the <code class=
"cCode">unmarshalXMLSignature</code> method of the factory to
unmarshal an <code class="cCode">XMLSignature</code> object, and
pass it the validation context we created earlier:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">

XMLSignature signature = 
&nbsp;&nbsp;factory.unmarshalXMLSignature(valContext);<a name=
"wp511419" id="wp511419"> </a>
</pre></div>
<a name="wp511420" id="wp511420"></a>
<h4 class="pHeading3">Validating the XML Signature</h4>
<a name="wp511555" id="wp511555"></a>
<p class="pBody">Now we are ready to validate the signature. We do
this by invoking the <code class="cCode">validate</code> method on
the <code class="cCode">XMLSignature</code> object, and pass it the
validation context as follows:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
boolean coreValidity = signature.validate(valContext);<a name=
"wp511557" id="wp511557"> </a>
</pre></div>
<a name="wp511421" id="wp511421"></a>
<p class="pBody">The <code class="cCode">validate</code> method
returns &quot;true&quot; if the signature validates successfully
according to the <code class="cCode">core validation rules</code>
in the <code class="cCode">W3C XML Signature Recommendation</code>,
and false otherwise.</p>
<a name="wp511422" id="wp511422"></a>
<h4 class="pHeading3">What If the XML Signature Fails to
Validate?</h4>
<a name="wp511567" id="wp511567"></a>
<p class="pBody">If the <code class=
"cCode">XMLSignature.validate</code> method returns false, we can
try to narrow down the cause of the failure. There are two phases
in core XML Signature validation:</p>
<div class="pSmartList1">
<div style="margin-left: 2em" class="pSmartList1"><a name=
"wp512008" id="wp512008"></a>
<div class="pSmartList1">
<ul>
<li><code class="cCode">Signature validation</code> (the
cryptographic verification of the signature)</li>
</ul>
</div>
<a name="wp512011" id="wp512011"></a>
<div class="pSmartList1">
<ul>
<li><code class="cCode">Reference validation</code> (the
verification of the digest of each reference in the signature)</li>
</ul>
</div>
</div>
</div>
<a name="wp512014" id="wp512014"></a>
<p class="pBody">Each phase must be successful for the signature to
be valid. To check if the signature failed to cryptographically
validate, we can check the status, as follows:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
boolean sv = 
&nbsp;&nbsp;signature.getSignatureValue().validate(valContext);
System.out.println(&quot;signature validation status: &quot; + sv);<a name="wp511569"
id="wp511569"> </a>
</pre></div>
<a name="wp511572" id="wp511572"></a>
<p class="pBody">We can also iterate over the references and check
the validation status of each one, as follows:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
Iterator i =
&nbsp;&nbsp;signature.getSignedInfo().getReferences().iterator();
for (int j=0; i.hasNext(); j++) {
&nbsp;&nbsp;boolean refValid = ((Reference) 
&nbsp;&nbsp;&nbsp;&nbsp;i.next()).validate(valContext);
&nbsp;&nbsp;System.out.println(&quot;ref[&quot;+j+&quot;] validity status: &quot; + 
&nbsp;&nbsp;&nbsp;&nbsp;refValid);
}<a name="wp511574" id="wp511574"> </a>
</pre></div>
<a name="wp511424" id="wp511424"></a>
<h4 class="pHeading3">Using KeySelectors</h4>
<a name="wp511588" id="wp511588"></a>
<p class="pBody"><code class="cCode">KeySelectors</code> are used
to find and select keys that are needed to validate an
XMLSignature. Earlier, when we created a <code class=
"cCode">DOMValidateContext</code> object, we passed a <code class=
"cCode">KeySelector</code> object as the first argument:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
DOMValidateContext valContext = new DOMValidateContext
&nbsp;&nbsp;(new KeyValueKeySelector(), nl.item(0));<a name=
"wp511590" id="wp511590"> </a>
</pre></div>
<a name="wp511593" id="wp511593"></a>
<p class="pBody">Alternatively, we could have passed a <code class=
"cCode">PublicKey</code> as the first argument if we already knew
what key is needed to validate the signature. However, we often
don't know.</p>
<a name="wp511425" id="wp511425"></a>
<p class="pBody">The <code class="cCode">KeyValueKeySelector</code>
is a concrete implementation of the abstract <code class=
"cCode">KeySelector</code> class. The <code class=
"cCode">KeyValueKeySelector</code> implementation tries to find an
appropriate validation key using the data contained in <code class=
"cCode">KeyValue</code> elements of the <code class=
"cCode">KeyInfo</code> element of an <code class=
"cCode">XMLSignature</code>. It does not determine if the key is
trusted. This is a very simple <code class=
"cCode">KeySelector</code> implementation, designed for
illustration rather than real-world usage. A more practical example
of a <code class="cCode">KeySelector</code> is one that searches a
<code class="cCode">KeyStore</code> for trusted keys that match
<code class="cCode">X509Data</code> information (for example,
<code class="cCode">X509SubjectName</code>, <code class=
"cCode">X509IssuerSerial</code>, <code class=
"cCode">X509SKI</code>, or <code class=
"cCode">X509Certificate</code> elements) contained in a
<code class="cCode">KeyInfo</code>.</p>
<a name="wp511606" id="wp511606"></a>
<p class="pBody">The implementation of the <code class=
"cCode">KeyValueKeySelector</code> is as follows:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
private static class KeyValueKeySelector extends KeySelector {

&nbsp;&nbsp;public KeySelectorResult select(KeyInfo keyInfo,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;KeySelector.Purpose purpose,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AlgorithmMethod method,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XMLCryptoContext context)
&nbsp;&nbsp;&nbsp;&nbsp;throws KeySelectorException {

&nbsp;&nbsp;&nbsp;&nbsp;if (keyInfo == null) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new KeySelectorException(&quot;Null KeyInfo object!&quot;);
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;SignatureMethod sm = (SignatureMethod) method;
&nbsp;&nbsp;&nbsp;&nbsp;List list = keyInfo.getContent();

&nbsp;&nbsp;&nbsp;&nbsp;for (int i = 0; i &lt; list.size(); i++) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XMLStructure xmlStructure = (XMLStructure) list.get(i);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (xmlStructure instanceof KeyValue) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PublicKey pk = null;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pk = ((KeyValue)xmlStructure).getPublicKey();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} catch (KeyException ke) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new KeySelectorException(ke);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// make sure algorithm is compatible with method
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (algEquals(sm.getAlgorithm(), 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pk.getAlgorithm())) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new SimpleKeySelectorResult(pk);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;throw new KeySelectorException(&quot;No KeyValue element 
found!&quot;);
&nbsp;&nbsp;}

&nbsp;&nbsp;static boolean algEquals(String algURI, String algName) {
&nbsp;&nbsp;&nbsp;&nbsp;if (algName.equalsIgnoreCase(&quot;DSA&quot;) &amp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;algURI.equalsIgnoreCase("http://www.w3.org/2009/xmldsig11#dsa-sha256")) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;
&nbsp;&nbsp;&nbsp;&nbsp;} else if (algName.equalsIgnoreCase(&quot;RSA&quot;) &amp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;algURI.equalsIgnoreCase("http://www.w3.org/2001/04/xmldsig-more#rsa-sha256")) {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;
&nbsp;&nbsp;&nbsp;&nbsp;} else {
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return false;
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;}
}<a name="wp511608" id="wp511608"> </a>
</pre></div>
<a name="wp511438" id="wp511438"></a>
<h3 class="pHeading2">genenveloped Example</h3>
<a name="wp511755" id="wp511755"></a>
<p class="pBody">The code discussed in this section is in the
<code class="cCode">GenEnveloped.java</code> file in the 
<!-- <code class="cVariable">JWSDP_HOME</code><code class="cCode">&gt;  -->
<code>docs/technotes/guides/security/xmldsig</code> directory. The
file on which it operates, <code class="cCode">envelope.xml</code>,
is in the same directory. It generates the file <code class=
"cCode">envelopedSignature.xml.</code></p>
<a name="wp512216" id="wp512216"></a>
<p class="pBody">To compile and run this sample, execute the
following command from the 
<!-- <code class="cCode">&lt;</code><code class="cVariable">JWSDP_HOME</code><code class="cCode">&gt;  -->
<code>docs/technotes/guides/security/xmldsig</code> directory:</p>
<code>$ javac GenEnveloped.java<br />
$ java GenEnveloped envelope.xml
envelopedSignature.xml<br /></code>
<p>The sample program will generate an enveloped signature of the
document in the file envelope.xml and store it in the file
<code>envelopedSignature.xml</code> in the current working
directory.</p>
<a name="wp511436" id="wp511436"></a>
<h4 class="pHeading3">Generating an XML Signature</h4>
<a name="wp511919" id="wp511919"></a>
<p class="pBody">This example shows you how to generate an XML
Signature using the XML Digital Signature API. More specifically,
the example generates an enveloped XML Signature of an XML
document. An enveloped signature is a signature that is contained
inside the content that it is signing. The example uses DOM (the
Document Object Model) to parse the XML document to be signed and a
JSR 105 DOM implementation to generate the resulting signature.</p>
<a name="wp511740" id="wp511740"></a>
<p class="pBody">A basic knowledge of XML Signatures and their
different components is helpful for understanding this section. See
<a href="http://www.w3.org/TR/xmldsig-core/" target=
"_blank"><code class=
"cCode">http://www.w3.org/TR/xmldsig-core/</code></a> for more
information.</p>
<a name="wp511741" id="wp511741"></a>
<h4 class="pHeading3">Instantiating the Document to be Signed</h4>
<a name="wp511913" id="wp511913"></a>
<p class="pBody">First, we use a JAXP <code class=
"cCode">DocumentBuilderFactory</code> to parse the XML document
that we want to sign. An application obtains the default
implementation for <code class=
"cCode">DocumentBuilderFactory</code> by calling the following line
of code:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
DocumentBuilderFactory dbf =
&nbsp;&nbsp;DocumentBuilderFactory.newInstance();<a name="wp513167"
id="wp513167"> </a>
</pre></div>
<a name="wp511915" id="wp511915"></a>
<p class="pBody">We must also make the factory namespace-aware:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
dbf.setNamespaceAware(true);<a name="wp511895" id="wp511895"> </a>
</pre></div>
<a name="wp511897" id="wp511897"></a>
<p class="pBody">Next, we use the factory to get an instance of a
<code class="cCode">DocumentBuilder</code>, which is used to parse
the document:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
DocumentBuilder builder = dbf.newDocumentBuilder();  
Document doc = builder.parse(new FileInputStream(argv[0]));<a name=
"wp511899" id="wp511899"> </a>
</pre></div>
<a name="wp511743" id="wp511743"></a>
<h4 class="pHeading3">Creating a Public Key Pair</h4>
<a name="wp511875" id="wp511875"></a>
<p class="pBody">We generate a public key pair. Later in the
example, we will use the private key to generate the signature. We
create the key pair with a <code class=
"cCode">KeyPairGenerator</code>. In this example, we will create a
DSA <code class="cCode">KeyPair</code> with a length of 2048 bytes
:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
KeyPairGenerator kpg = KeyPairGenerator.getInstance(&quot;DSA&quot;);
kpg.initialize(2048);
KeyPair kp = kpg.generateKeyPair();<a name="wp511877" id=
"wp511877"> </a>
</pre></div>
<a name="wp511744" id="wp511744"></a>
<p class="pBody">In practice, the private key is usually previously
generated and stored in a <code class="cCode">KeyStore</code> file
with an associated public key certificate.</p>
<a name="wp511745" id="wp511745"></a>
<h4 class="pHeading3">Creating a Signing Context</h4>
<a name="wp511864" id="wp511864"></a>
<p class="pBody">We create an XML Digital Signature <code class=
"cCode">XMLSignContext</code> containing input parameters for
generating the signature. Since we are using DOM, we instantiate a
<code class="cCode">DOMSignContext</code> (a subclass of
<code class="cCode">XMLSignContext</code>), and pass it two
parameters, the private key that will be used to sign the document
and the root of the document to be signed:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
DOMSignContext dsc = new DOMSignContext
&nbsp;&nbsp;(kp.getPrivate(), doc.getDocumentElement());<a name=
"wp511866" id="wp511866"> </a>
</pre></div>
<a name="wp511747" id="wp511747"></a>
<h4 class="pHeading3">Assembling the XML Signature</h4>
<a name="wp511799" id="wp511799"></a>
<p class="pBody">We assemble the different parts of the
<code class="cCode">Signature</code> element into an <code class=
"cCode">XMLSignature</code> object. These objects are all created
and assembled using an <code class=
"cCode">XMLSignatureFactory</code> object. An application obtains a
DOM implementation of <code class=
"cCode">XMLSignatureFactory</code> by calling the following line of
code:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
XMLSignatureFactory fac = 
&nbsp;&nbsp;XMLSignatureFactory.getInstance(&quot;DOM&quot;);<a name="wp511801"
id="wp511801"> </a>
</pre></div>
<a name="wp511803" id="wp511803"></a>
<p class="pBody">We then invoke various factory methods to create
the different parts of the <code class="cCode">XMLSignature</code>
object as shown below. We create a <code class=
"cCode">Reference</code> object, passing to it the following:</p>
<div class="pSmartList1">
<div style="margin-left: 2em" class="pSmartList1"><a name=
"wp512044" id="wp512044"></a>
<div class="pSmartList1">
<ul>
<li>The URI of the object to be signed (We specify a URI of
&quot;&quot;, which implies the root of the document.)</li>
</ul>
</div>
<a name="wp512049" id="wp512049"></a>
<div class="pSmartList1">
<ul>
<li>The <code class="cCode">DigestMethod</code> (we use SHA1)</li>
</ul>
</div>
<a name="wp512050" id="wp512050"></a>
<div class="pSmartList1">
<ul>
<li>A single <code class="cCode">Transform</code>, the enveloped
<code class="cCode">Transform</code>, which is required for
enveloped signatures so that the signature itself is removed before
calculating the signature value</li>
</ul>
</div>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
Reference ref = fac.newReference
&nbsp;&nbsp;(&quot;&quot;, fac.newDigestMethod(DigestMethod.SHA256, null),
&nbsp;&nbsp;&nbsp;&nbsp;Collections.singletonList
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(fac.newTransform(Transform.ENVELOPED,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(TransformParameterSpec) null)), null, null);<a name="wp511805"
id="wp511805"> </a>
</pre></div>
</div>
</div>
<a name="wp511811" id="wp511811"></a>
<p class="pBody">Next, we create the <code class=
"cCode">SignedInfo</code> object, which is the object that is
actually signed, as shown below. When creating the <code class=
"cCode">SignedInfo</code>, we pass as parameters:</p>
<div class="pSmartList1">
<div style="margin-left: 2em" class="pSmartList1"><a name=
"wp512056" id="wp512056"></a>
<div class="pSmartList1">
<ul>
<li>The <code class="cCode">CanonicalizationMethod</code> (we use
inclusive and preserve comments)</li>
</ul>
</div>
<a name="wp512059" id="wp512059"></a>
<div class="pSmartList1">
<ul>
<li>The <code class="cCode">SignatureMethod</code> (we use
DSA)</li>
</ul>
</div>
<a name="wp512060" id="wp512060"></a>
<div class="pSmartList1">
<ul>
<li>A list of <code class="cCode">References</code> (in this case,
only one)</li>
</ul>
</div>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
SignedInfo si = fac.newSignedInfo
&nbsp;&nbsp;(fac.newCanonicalizationMethod
&nbsp;&nbsp;&nbsp;&nbsp;(CanonicalizationMethod.INCLUSIVE_WITH_COMMENTS,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(C14NMethodParameterSpec) null),
&nbsp;&nbsp;&nbsp;&nbsp;fac.newSignatureMethod("http://www.w3.org/2009/xmldsig11#dsa-sha256", null),
&nbsp;&nbsp;&nbsp;&nbsp;Collections.singletonList(ref));<a name=
"wp511813" id="wp511813"> </a>
</pre></div>
</div>
</div>
<a name="wp511819" id="wp511819"></a>
<p class="pBody">Next, we create the optional <code class=
"cCode">KeyInfo</code> object, which contains information that
enables the recipient to find the key needed to validate the
signature. In this example, we add a <code class=
"cCode">KeyValue</code> object containing the public key. To create
<code class="cCode">KeyInfo</code> and its various subtypes, we use
a <code class="cCode">KeyInfoFactory</code> object, which can be
obtained by invoking the <code class=
"cCode">getKeyInfoFactory</code> method of the <code class=
"cCode">XMLSignatureFactory</code>, as follows:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
KeyInfoFactory kif = fac.getKeyInfoFactory();<a name="wp511822" id=
"wp511822"> </a>
</pre></div>
<a name="wp511824" id="wp511824"></a>
<p class="pBody">We then use the <code class=
"cCode">KeyInfoFactory</code> to create the <code class=
"cCode">KeyValue</code> object and add it to a <code class=
"cCode">KeyInfo</code> object:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
KeyValue kv = kif.newKeyValue(kp.getPublic());
KeyInfo ki = kif.newKeyInfo(Collections.singletonList(kv));<a name=
"wp511826" id="wp511826"> </a>
</pre></div>
<a name="wp511829" id="wp511829"></a>
<p class="pBody">Finally, we create the <code class=
"cCode">XMLSignature</code> object, passing as parameters the
<code class="cCode">SignedInfo</code> and <code class=
"cCode">KeyInfo</code> objects that we created earlier:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
XMLSignature signature = fac.newXMLSignature(si, ki);<a name=
"wp511831" id="wp511831"> </a>
</pre></div>
<a name="wp511836" id="wp511836"></a>
<p class="pBody">Notice that we haven't actually generated the
signature yet; we'll do that in the next step.</p>
<a name="wp511749" id="wp511749"></a>
<h4 class="pHeading3">Generating the XML Signature</h4>
<a name="wp511787" id="wp511787"></a>
<p class="pBody">Now we are ready to generate the signature, which
we do by invoking the <code class="cCode">sign</code> method on the
<code class="cCode">XMLSignature</code> object, and pass it the
signing context as follows:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
signature.sign(dsc);<a name="wp511789" id="wp511789"> </a>
</pre></div>
<a name="wp511750" id="wp511750"></a>
<p class="pBody">The resulting document now contains a signature,
which has been inserted as the last child element of the root
element.</p>
<a name="wp511751" id="wp511751"></a>
<h4 class="pHeading3">Printing or Displaying the Resulting
Document</h4>
<a name="wp511768" id="wp511768"></a>
<p class="pBody">You can use the following code to print the
resulting signed document to a file or standard output:</p>
<div class="pPreformattedRelative">
<pre class="pPreformattedRelative">
OutputStream os;
if (args.length &gt; 1) {
&nbsp;&nbsp;os = new FileOutputStream(args[1]);
} else {
&nbsp;&nbsp;os = System.out;
}<a name="wp511770" id="wp511770"> </a>
TransformerFactory tf = TransformerFactory.newInstance();
Transformer trans = tf.newTransformer();
trans.transform(new DOMSource(doc), new StreamResult(os));<a name=
"wp511777" id="wp511777"> </a>
</pre></div>
<a name="wp511766" id="wp511766"></a>
<p class="pBody"></p>
<!-- *****  end appended files ***** -->
<!-- 
<script language="JavaScript" src="/js/omi/jsc/s_code_remote.js"></script>
-->

<!--  footer start -->
<div id="javasefooter">
<div class="hr">
<hr /></div>
<div id="javasecopyright">
<img id="oraclelogofooter" src=
"../../../../images/oraclelogo.gif" alt="Oracle and/or its affiliates"
border="0" width="100" height="29" name=
"oraclelogofooter" />

<a href="../../../../legal/cpyr.html">Copyright
&#169;</a> 1993, 2018, Oracle and/or its affiliates. All rights
reserved.</div>
<div id="javasecontactus">
<a href=
"http://docs.oracle.com/javase/feedback.html">Contact
Us</a>
</div>
</div>
<!-- footer end -->

<!-- STATIC FOOTER -->

</body>
</html>
