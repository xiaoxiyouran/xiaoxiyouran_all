<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml" xml:lang=
"en-US">
<head>
<title>Java Remote Method Invocation: 7 - Remote Object
Activation</title>
</head>
<body bgcolor="#FFFFFF">
<a href="#skip" title="Skip navigation bar"></a>
<table width="100%" summary="">
<tr>
<td><a href="rmiTOC.html">CONTENTS</a> | <a href=
"rmi-activation4.html">PREV</a> | <a href=
"rmi-stubs2a.html">NEXT</a></td>
<td align="right"><i>Java Remote Method Invocation</i></td>
</tr>
</table>
<br />
<a name="skip" id="skip"></a>
<hr size="8" width="35%" align="left" noshade="noshade" />
<h2><a name="a5112" id="a5112"><i>7.4</i> Activation
Interfaces</a></h2>
<a name="a4259" id="a4259"><!-- --></a> In the RMI activation
protocol, there are two guarantees that the activator must make for
the system to function properly:
<ul>
<li><a name="a1850" id="a1850"><!-- --></a> like all system
daemons, the activator should remain running while the machine is
up, and</li>
</ul>
<ul>
<li><a name="a1851" id="a1851"><!-- --></a> the activator must not
reactivate remote objects that are already active.</li>
</ul>
<a name="a4268" id="a4268"><!-- --></a> The activator maintains a
database of appropriate information for the groups and objects that
it participates in activating.
<p><br /></p>
<h3><a name="a4269" id="a4269"><!-- --></a> <i>7.4.1</i> The
<code>Activator</code> Interface</h3>
<a name="a1697" id="a1697"><!-- --></a> The activator is one of the
entities that participates during the activation process. As
described earlier, a faulting reference (inside a stub) calls the
activator&#39;s <code>activate</code> method to obtain a
&#34;live&#34; reference to an activatable remote object. Upon
receiving a request for activation, the activator looks up the
activation descriptor for the activation identifier, <em>id</em>,
determines the group in which the object should be activated, and
invokes the <code>newInstance</code> method on the activation
group&#39;s instantiator (the remote interface
<code>ActivationGroup</code> is described below). The activator
initiates the execution of activation groups as necessary. For
example, if an activation group for a specific group descriptor is
not already executing, the activator will spawn a child JVM for the
activation group to establish the group in the new JVM.
<p><a name="a2414" id="a2414"><!-- --></a> The activator is
responsible for monitoring and detecting when activation groups
fail so that it can remove stale remote references from its
internal tables.</p>
<pre class="codeblock">
package java.rmi.activation;<br />public interface Activator extends java.rmi.Remote
{
        java.rmi.MarshalledObject activate(ActivationID id,
                                           boolean force)
                throws UnknownObjectException, ActivationException,
                       java.rmi.RemoteException;
}
</pre>
<a name="a2504" id="a2504"><!-- --></a> The <code>activate</code>
method activates the object associated with the activation
identifier, <em>id</em>. If the activator knows the object to be
active already and the <em>force</em> parameter is <em>false</em>,
the stub with a &#34;live&#34; reference is returned immediately to
the caller; otherwise, if the activator does not know that the
corresponding remote object is active or the <em>force</em>
parameter is <code>true</code>, the activator uses the activation
descriptor information (previously registered to obtain the
<em>id</em>) to determine the group (JVM) in which the object
should be activated. If an Activation<code>Instantiator</code>
corresponding to the object&#39;s group already exists, the
activator invokes the activation instantiator&#39;s
<code>newInstance</code> method, passing it the <em>id</em> and the
object&#39;s activation descriptor.
<p><a name="a1883" id="a1883"><!-- --></a> If the activation
instantiator (group) for the object&#39;s group descriptor does not
yet exist, the activator starts a new incarnation of an
<code>ActivationInstantiator</code> executing (by spawning a child
process, for example). When the activator re-creates an
<code>ActivationInstantiator</code> for a group, it must increment
the group&#39;s incarnation number. Note that the incarnation
number is zero-based. The activation system uses incarnation
numbers to detect late <code>ActivationSystem.activeGroup</code>
and <code>ActivationMonitor.inactiveGroup</code> calls. The
activation system discards calls with an earlier incarnation number
than the current number for the group.</p>
<hr noshade="noshade" size="1" />
<b><a name="a3699" id="a3699">Note -</a></b> The activator must
communicate both the activation group&#39;s identifier, descriptor,
and incarnation number when it starts up a new activation group.
The activator spawns an activation group in a separate JVM (as a
separate or child process, for example), and therefore must pass
information specifying the information necessary to create the
group via the <code>ActivationGroup.createGroup</code> method. How
the activator sends this information to the spawned process is
unspecified, however, this information could be sent in the form of
marshalled objects to the child process&#39;s <em>standard
input</em>.
<hr noshade="noshade" size="1" />
<a name="a3654" id="a3654"><!-- --></a> When the activator receives
the activation group&#39;s call back (via the
<code>ActivationSystem.activeGroup</code> method) specifying the
activation group&#39;s reference and incarnation number, the
activator can then invoke that activation instantiator&#39;s
<code>newInstance</code> method to forward each pending activation
request to the activation instantiator and return the result (a
<em>marshalled</em> remote object reference, a stub) to each
caller.
<p><a name="a3632" id="a3632"><!-- --></a> Note that the activator
receives a <code>MarshalledObject</code> instead of a
<code>Remote</code> object so that the activator does not need to
load the code for that object, or participate in distributed
garbage collection for that object. If the activator kept a strong
reference to the remote object, the activator would then prevent
the object from being garbage collected under the normal
distributed garbage collection mechanism.</p>
<p><a name="a1782" id="a1782"><!-- --></a> The
<code>activate</code> method throws
<code>ActivationException</code> if activation fails. Activation
may fail for a variety of reasons: the class could not be found,
the activation group could not be contacted, etc. The
<code>activate</code> method throws
<code>UnknownObjectException</code> if no activation descriptor for
the activation identifier, <em>id</em>, has been previously
registered with this activator. <code>RemoteException</code> is
thrown if the remote call to the activator fails.</p>
<p><br /></p>
<h3><i>7.4.2</i> The <code>ActivationSystem</code> Interface</h3>
<a name="a3664" id="a3664"><!-- --></a> The
<code>ActivationSystem</code> provides a means for registering
groups and <em>activatable</em> objects to be activated within
those groups. The <code>ActivationSystem</code> works closely with
both the <code>Activator</code>, which activates objects registered
via the <code>ActivationSystem</code>, and the
<code>ActivationMonitor</code>, which obtains information about
active and inactive objects and inactive groups.
<pre class="codeblock">
package java.rmi.activation;<br />public interface ActivationSystem extends java.rmi.Remote
{
        public static final int SYSTEM_PORT = 1098;

        ActivationGroupID registerGroup(ActivationGroupDesc desc)
                throws ActivationException, java.rmi.RemoteException;

        ActivationMonitor activeGroup(ActivationGroupID id,
                                      ActivationInstantiator group,
                                      long incarnation)
                throws UnknownGroupException, ActivationException,
                       java.rmi.RemoteException;

        void unregisterGroup(ActivationGroupID id)
                throws ActivationException, UnknownGroupException,
                       java.rmi.RemoteException;

        ActivationID registerObject(ActivationDesc desc)
                throws ActivationException, UnknownGroupException,
                       java.rmi.RemoteException;

        void unregisterObject(ActivationID id)
                throws ActivationException, UnknownObjectException,
                       java.rmi.RemoteException;

        void shutdown() throws java.rmi.RemoteException;
}
</pre>
<hr noshade="noshade" size="1" />
<b><a name="a3653" id="a3653">Note -</a></b> As a security measure,
all of the above methods (<code>registerGroup</code>,
<code>activeGroup</code>, <code>unregisterGroup</code>,
<code>registerObject</code>, <code>unregisterObject</code>, and
<code>shutdown</code>) will throw
<code>java.rmi.AccessException</code>, a subclass of
<code>java.rmi.RemoteException,</code> if called from a client that
does not reside on the same host as the activation system.
<hr noshade="noshade" size="1" />
<a name="a4280" id="a4280"><!-- --></a> The
<code>registerObject</code> method is used to register an
activation descriptor, <em>desc</em>, and obtain an activation
identifier for an activatable remote object. The
<code>ActivationSystem</code> creates an <code>ActivationID</code>
(an activation identifier) for the object specified by the
descriptor, <em>desc</em>, and records, in stable storage, the
activation descriptor and its associated identifier for later use.
When the <code>Activator</code> receives an <code>activate</code>
request for a specific identifier, it looks up the activation
descriptor (registered previously) for the specified identifier and
uses that information to activate the object. If the group referred
to in <em>desc</em> is not registered with this system, then the
method throws <code>UnknownGroupException</code>. If registration
fails (e.g., database update failure, etc), then the method throws
<code>ActivationException</code>. If the remote call fails, then
<code>RemoteException</code> is thrown.
<p><a name="a4425" id="a4425"><!-- --></a> The
<code>unregisterObject</code> method removes the activation
identifier, <em>id</em>, and associated descriptor previously
registered with the <code>ActivationSystem</code>. After the call
completes, the object can no longer be activated via the object's
activation <em>id</em>. If the object <em>id</em> is unknown (not
registered) the method throws <code>UnknownObjectException</code>.
If the unregister operation fails (e.g., database update failure,
etc.), then the method throws <code>ActivationException</code>. If
the remote call fails, then <code>RemoteException</code> is
thrown.</p>
<p><a name="a4438" id="a4438"><!-- --></a> The
<code>registerGroup</code> method registers the activation group
specified by the group descriptor, <em>desc</em>, with the
activation system and returns the <code>ActivationGroupID</code>
assigned to that group. An activation group must be registered with
the <code>ActivationSystem</code> before objects can be registered
within that group. If group registration fails, the method throws
<code>ActivationException</code>. If the remote call fails, then
<code>RemoteException</code> is thrown.</p>
<p><a name="a4328" id="a4328"><!-- --></a> The
<code>activeGroup</code> method is a call back from the
<code>ActivationGroup</code> (with the identifier, <em>id)</em>, to
inform the activation system that <em>group</em> is now active and
is the <code>ActivationInstantiator</code> for that JVM. This call
is made internally by the <code>ActivationGroup.createGroup</code>
method to obtain an <code>ActivationMonitor</code> that the group
uses to update the system regarding objects&#39; and the
group&#39;s status (i.e., that the group or objects within that
group have become inactive). If the group is not registered, then
the method throws <code>UnknownGroupException</code>. If the group
is already active, then <code>ActivationException</code> is thrown.
If the remote call to the activation system fails, then
<code>RemoteException</code> is thrown.</p>
<p><a name="a4721" id="a4721"><!-- --></a> The
<code>unregisterGroup</code> method removes the activation group
with identifier, <em>id</em>, from the activation system. An
activation group makes this call back to inform the activator that
the group should be destroyed. If this call completes successfully,
objects can no longer be registered or activated within the group.
All information of the group and its associated objects is removed
from the system. The method throws
<code>UnknownGroupException</code> if the group is not registered.
If the remote call fails, then <code>RemoteException</code> is
thrown. If the unregister fails, <code>ActivationException</code>
is thrown (e.g., database update failure, etc.).</p>
<p><a name="a5821" id="a5821"><!-- --></a> The
<code>shutdown</code> method gracefully terminates (asynchronously)
the activation system and all related activation processes
(activator, monitors and groups). All groups spawned by the
activation daemon will be destroyed and the activation daemon will
exit. In order to shut down the activation system daemon,
<code>rmid</code>, execute the command:</p>
<pre class="codeblock">
                rmid -stop [-port num]
</pre>
<a name="a5825" id="a5825"><!-- --></a> This command will shut down
the activation daemon on the specified port (if no port is
specified, the daemon on the default port will be shut down).
<p><br /></p>
<h3><i>7.4.3</i> The <code>ActivationMonitor</code> Class</h3>
<a name="a5261" id="a5261"><!-- --></a> An
<code>ActivationMonitor</code> is specific to an
<code>ActivationGroup</code> and is obtained when a group is
reported via a call to <code>ActivationSystem.activeGroup</code>
(this is done internally by the
<code>ActivationGroup.createGroup</code> method). An activation
group is responsible for informing its
<code>ActivationMonitor</code> when:
<dl>
<dd><a name="a6668" id="a6668"><!-- --></a></dd>
<dd>a. its objects become active,
<p><a name="a6660" id="a6660"><!-- --></a></p>
</dd>
<dd>b. its objects become inactive, or
<p><a name="a6677" id="a6677"><!-- --></a></p>
</dd>
<dd>c. the group as a whole becomes inactive.</dd>
</dl>
<br />
<pre class="codeblock">
package java.rmi.activation;<br />public interface ActivationMonitor 
        extends java.rmi.Remote
{

        public abstract void inactiveObject(ActivationID id)
                throws UnknownObjectException, RemoteException;

        public void activeObject(ActivationID id, 
                                 java.rmi.MarshalledObject mobj)        
                throws UnknownObjectException, java.rmi.RemoteException;

        public void inactiveGroup(ActivationGroupID id,
                                  long incarnation)
                throws UnknownGroupException, java.rmi.RemoteException; 
}
</pre>
<a name="a5265" id="a5265"><!-- --></a> An activation group calls
its monitor&#39;s <code>inactiveObject</code> method when an object
in its group becomes inactive (deactivates). An activation group
discovers that an object (that it participated in activating) in
its JVM is no longer active via a call to the activation
group&#39;s <code>inactiveObject</code> method.
<p><a name="a5269" id="a5269"><!-- --></a> The
<code>inactiveObject</code> call informs the
<code>ActivationMonitor</code> that the remote object reference it
holds for the object with the activation identifier, <em>id</em>,
is no longer valid. The monitor considers the reference associated
with <em>id</em> as a stale reference. Since the reference is
considered stale, a subsequent <code>activate</code> call for the
same activation identifier results in re-activating the remote
object. If the object is not known to the
<code>ActivationMonitor</code>, the method throws
<code>UnknownObjectException</code>. If the remote call fails, then
<code>RemoteException</code> is thrown.</p>
<p><a name="a5273" id="a5273"><!-- --></a> The
<code>activeObject</code> call informs the
<code>ActivationMonitor</code> that the object associated with
<em>id</em> is now active. The parameter <em>obj</em> is the
marshalled representation of the object&#39;s stub. An
<code>ActivationGroup</code> must inform its monitor if an object
in its group becomes active by other means than being activated
directly by the system (i.e., the object is registered and
&#34;activated&#34; itself). If the object id is not previously
registered, then the method throws
<code>UnknownObjectException</code>. If the remote call fails, then
<code>RemoteException</code> is thrown.</p>
<p><a name="a5276" id="a5276"><!-- --></a> The
<code>inactiveGroup</code> call informs the monitor that the group
specified by <em>id</em> and <em>incarnation</em> is now inactive.
The group will be re-created with a greater incarnation number upon
a subsequent request to activate an object within the group. A
group becomes inactive when all objects in the group report that
they are inactive. If either the group <em>id</em> is not
registered or the incarnation number is smaller than the current
incarnation for the group, then the method throws
<code>UnknownGroupException</code>. If the remote call fails, then
<code>RemoteException</code> is thrown.</p>
<p><br /></p>
<h3><a name="a5201" id="a5201"><!-- --></a> <i>7.4.4</i> The
<code>ActivationInstantiator</code> Class</h3>
<a name="a5224" id="a5224"><!-- --></a> The
<code>ActivationInstantiator</code> is responsible for creating
instances of activatable objects. A concrete subclass of
<code>ActivationGroup</code> implements the
<code>newInstance</code> method to handle creating objects within
the group.
<p><a name="a5225" id="a5225"><!-- --></a></p>
<pre class="codeblock">
package java.rmi.activation;<br />public interface ActivationInstantiator 
        extends java.rmi.Remote
{
        public MarshalledObject newInstance(ActivationID id,
                                            ActivationDesc desc)
                throws ActivationException, java.rmi.RemoteException;
                                                                                
}
</pre>
<a name="a5194" id="a5194"><!-- --></a> The activator calls an
instantiator&#39;s <code>newInstance</code> method in order to
re-create in that group an object with the activation identifier,
<em>id</em>, and descriptor, <em>desc</em>. The instantiator is
responsible for:
<ul>
<li><a name="a5226" id="a5226"><!-- --></a> determining the class
for the object using the descriptor&#39;s <code>getClassName</code>
method,</li>
<li><a name="a5227" id="a5227"><!-- --></a> loading the class from
the codebase path obtained from the descriptor (using the
<code>getLocation</code> method),</li>
<li><a name="a5228" id="a5228"><!-- --></a> creating an instance of
the class by invoking the special &#34;activation&#34; constructor
of the object&#39;s class that takes two arguments: the
object&#39;s <code>ActivationID</code>, and the
<code>MarshalledObject</code> containing object-specific
initialization data, and</li>
<li><a name="a5229" id="a5229"><!-- --></a> returning a
<code>MarshalledObject</code> containing the remote object it
created.</li>
</ul>
<a name="a5230" id="a5230"><!-- --></a> An instantiator is also
responsible for reporting when objects it creates or activates are
no longer active, so that it can make the appropriate
<code>inactiveObject</code> call to its
<code>ActivationMonitor</code> (see the
<code>ActivationGroup</code> class for more details).
<p><a name="a5231" id="a5231"><!-- --></a> If object activation
fails, then the newInstance method throws
<code>ActivationException</code>. If the remote call fails, then
the method throws <code>RemoteException</code>.</p>
<p><br /></p>
<h3><a name="a4724" id="a4724"><!-- --></a> <i>7.4.5</i> The
<code>ActivationGroupDesc</code> Class</h3>
<a name="a4723" id="a4723"><!-- --></a> An activation group
descriptor (<code>ActivationGroupDesc</code>) contains the
information necessary to create or re-create an activation group in
which to activate objects in the same JVM.
<p><a name="a4499" id="a4499"><!-- --></a> Such a descriptor
contains:</p>
<ul>
<li><a name="a4528" id="a4528"><!-- --></a> the group's class name
(a class name of <code>null</code> indicates the default
<code>ActivationGroup</code> implementation),</li>
<li><a name="a4501" id="a4501"><!-- --></a> the group's codebase
path (the location of the group's class), and</li>
<li><a name="a4502" id="a4502"><!-- --></a> a &#34;marshalled&#34;
object that can contain object-specific initialization data.</li>
</ul>
<a name="a4538" id="a4538"><!-- --></a> The group's class must be a
concrete subclass of <code>ActivationGroup</code>. A subclass of
<code>ActivationGroup</code> is created or re-created via the
<code>ActivationGroup.createGroup</code> static method, which
invokes a special constructor that takes two arguments:
<ul>
<li><a name="a4543" id="a4543"><!-- --></a> the group's
<code>ActivationGroupID</code>, and</li>
<li><a name="a4552" id="a4552"><!-- --></a> the group's
initialization data (in a
<code>java.rmi.MarshalledObject</code>)</li>
</ul>
<a name="a4556" id="a4556"><!-- --></a>
<pre class="codeblock">
package java.rmi.activation;<br />public final class ActivationGroupDesc 
        implements java.io.Serializable
{
        
        public ActivationGroupDesc(java.util.Properties props,
                                   CommandEnvironment env);;

        public ActivationGroupDesc(String className,
                                   String codebase,
                                   java.rmi.MarshalledObject data,
                                   java.util.Properties props,
                                   CommandEnvironment env);

        public String getClassName();

        public String getLocation();

        public java.rmi.MarshalledObject getData();

        public CommandEnvironment getCommandEnvironment();
        
        public java.util.Properties getPropertiesOverrides();

}
</pre>
<a name="a4580" id="a4580"><!-- --></a> The first constructor
creates a group descriptor that uses system default for group
implementation and code location. Properties specify Java
application environment overrides (which will override system
properties in the group implementation's JVM). The command
environment can control the exact command/options used in starting
the child JVM, or can be <code>null</code> to accept
<code>rmid</code>'s default. This constructor will create an
<code>ActivationGroupDesc</code> with a <code>null</code> group
class name, which indicates the system&#39;s default
<code>ActivationGroup</code> implementation.
<p><a name="a4685" id="a4685"><!-- --></a> The second constructor
is the same as the first, but allows the specification of
<code>Properties</code> and <code>CommandEnvironment</code>.</p>
<p><a name="a4702" id="a4702"><!-- --></a> The
<code>getClassName</code> method returns the group&#39;s class name
(possibly <code>null</code>). A <code>null</code> group class name
indicates the system&#39;s default <code>ActivationGroup</code>
implementation.</p>
<p><a name="a4707" id="a4707"><!-- --></a> The
<code>getLocation</code> method returns the codebase path from
where the group&#39;s class can be loaded.</p>
<p><a name="a6175" id="a6175"><!-- --></a> The <code>getData</code>
method returns the group&#39;s initialization data in marshalled
form.</p>
<p><a name="a6206" id="a6206"><!-- --></a> The
<code>getCommandEnvironment</code> method returns the command
environment (possibly <code>null</code>).</p>
<p><a name="a6207" id="a6207"><!-- --></a> The
<code>getPropertiesOverrides</code> method returns the properties
overrides (possibly <code>null</code>) for this descriptor.</p>
<p><br /></p>
<h3><a name="a6176" id="a6176"><!-- --></a> <i>7.4.6</i> The
<code>ActivationGroupDesc.CommandEnvironment</code> Class</h3>
<a name="a6178" id="a6178"><!-- --></a> The
<code>CommandEnvironment</code> class allows overriding default
system properties and specifying implemention-defined options for
an <code>ActivationGroup</code>.
<pre class="codeblock">
public static class CommandEnvironment 
        implements java.io.Serializable
{
        public CommandEnvironment(String cmdpath, String[] args);
        public boolean equals(java.lang.Object);
        public String[] getCommandOptions();
        public String getCommandPath();
        public int hashCode();


}
</pre>
<a name="a6186" id="a6186"><!-- --></a> The constructor creates a
<code>CommandEnvironment</code> with the given command,
<em>cmdpath</em>, and additional command line options,
<em>args</em>.
<p><a name="a6229" id="a6229"><!-- --></a> The <code>equals</code>
implements content equality for command environment objects. The
<code>hashCode</code> method is implemented appropriately so that a
<code>CommandEnvironment</code> can be stored in a hash table if
necessary.</p>
<p><a name="a6232" id="a6232"><!-- --></a> The
<code>getCommandOptions</code> method returns the environment
object&#39;s command line options.</p>
<p><a name="a6233" id="a6233"><!-- --></a> The
<code>getCommandPath</code> method returns the environment
object&#39;s command string.</p>
<p><br /></p>
<h3><a name="a5124" id="a5124"><!-- --></a> <i>7.4.7</i> The
<code>ActivationGroupID</code> Class</h3>
<a name="a5289" id="a5289"><!-- --></a> The identifier for a
registered activation group serves several purposes:
<ul>
<li><a name="a5290" id="a5290"><!-- --></a> it identifies the group
uniquely within the activation system, and</li>
</ul>
<ul>
<li><a name="a5291" id="a5291"><!-- --></a> it contains a reference
to the group&#39;s activation system so that the group can contact
its activation system when necessary.</li>
</ul>
<a name="a5294" id="a5294"><!-- --></a> The
<code>ActivationGroupID</code> is returned from the call to
<code>ActivationSystem.registerGroup</code> and is used to identify
the group within the activation system. This group identifier is
passed as one of the arguments to the activation group&#39;s
special constructor when an activation group is created or
re-created.
<p><a name="a5314" id="a5314"><!-- --></a></p>
<pre class="codeblock">
package java.rmi.activation;<br />public class ActivationGroupID implements java.io.Serializable
{
        public ActivationGroupID(ActivationSystem system);

        public ActivationSystem getSystem();

        public boolean equals(Object obj);

        public int hashCode();
}
</pre>
<a name="a5299" id="a5299"><!-- --></a> The
<code>ActivationGroupID</code> constructor creates a unique group
identifier whose ActivationSystem is <em>system</em>.
<p><a name="a5315" id="a5315"><!-- --></a> The
<code>getSystem</code> method returns the activation system for the
group.</p>
<p><a name="a5317" id="a5317"><!-- --></a> The
<code>hashCode</code> method returns a hashcode for the group&#39;s
identifier. Two group identifiers that refer to the same remote
group will have the same hash code.</p>
<p><a name="a5318" id="a5318"><!-- --></a> The <code>equals</code>
method compares two group identifiers for content equality. The
method returns <code>true</code> if both of the following
conditions are true: 1) the unique identifiers are equivalent (by
content), and 2) the activation system specified in each refers to
the same remote object.</p>
<p><br /></p>
<h3><a name="a1830" id="a1830"><!-- --></a> <i>7.4.8</i> The
<code>ActivationGroup</code> Class</h3>
<a name="a6682" id="a6682"><!-- --></a> An
<code>ActivationGroup</code> is responsible for creating new
instances of activatable objects in its group, informing its
<code>ActivationMonitor</code> when:
<dl>
<dd><a name="a6683" id="a6683"><!-- --></a></dd>
<dd><strong>a.</strong> its objects become active,
<p><a name="a6684" id="a6684"><!-- --></a></p>
</dd>
<dd><strong>b.</strong> its objects become inactive, or
<p><a name="a6685" id="a6685"><!-- --></a></p>
</dd>
<dd><strong>c.</strong> the group as a whole becomes inactive.</dd>
</dl>
<a name="a4849" id="a4849"><!-- --></a> An
<code>ActivationGroup</code> is <em>initially</em> created in one
of several ways:
<ul>
<li><a name="a4861" id="a4861"><!-- --></a> as a side-effect of
creating a &#34;default&#34; <code>ActivationDesc</code> for an
object, or</li>
<li><a name="a4735" id="a4735"><!-- --></a> by an explicit call to
the <code>ActivationGroup.createGroup</code> method, or</li>
<li><a name="a4736" id="a4736"><!-- --></a> as a side-effect of
activating the first object in a group whose
<code>ActivationGroupDesc</code> was only registered.</li>
</ul>
<a name="a4877" id="a4877"><!-- --></a> Only the activator can
<em>re-create</em> an <code>ActivationGroup</code>. The activator
spawns, as needed, a separate JVM (as a child process, for example)
for each registered activation group and directs activation
requests to the appropriate group. It is implementation specific
how JVMs are spawned. An activation group is created via the
<code>ActivationGroup.createGroup</code> static method. The
<code>createGroup</code> method has two requirements on the group
to be created: 1) the group must be a concrete subclass of
<code>ActivationGroup</code>, and 2) the group must have a
constructor that takes two arguments:
<ul>
<li><a name="a4900" id="a4900"><!-- --></a> the group's
<code>ActivationGroupID</code>, and</li>
<li><a name="a4753" id="a4753"><!-- --></a> the group's
initialization data (in a <code>MarshalledObject</code>)</li>
</ul>
<a name="a4907" id="a4907"><!-- --></a> When created, the default
implementation of <code>ActivationGroup</code> will set the system
properties to the system properties in force when the
<code>ActivationGroupDesc</code> was created, and will set the
security manager to the <code>java.rmi.RMISecurityManager</code>.
If your application requires some specific properties to be set
when objects are activated in the group, the application should set
the properties before creating any <code>ActivationDesc</code>s
(before the default <code>ActivationGroupDesc</code> is created).
<pre class="codeblock">
package java.rmi.activation;<br />public abstract class ActivationGroup 
        extends UnicastRemoteObject
        implements ActivationInstantiator
{
        protected ActivationGroup(ActivationGroupID groupID)
                throws java.rmi.RemoteException;

        public abstract MarshalledObject newInstance(ActivationID id,
                                                     ActivationDesc desc)
                throws ActivationException, java.rmi.RemoteException;

        public abstract boolean inactiveObject(ActivationID id)
                throws ActivationException, UnknownObjectException,
                       java.rmi.RemoteException;

        public static ActivationGroup createGroup(ActivationGroupID id,
                                                  ActivationGroupDesc desc,
                                                  long incarnation)
                throws ActivationException;
 
        public static ActivationGroupID currentGroupID();

        public static void setSystem(ActivationSystem system)
                throws ActivationException;

        public static ActivationSystem getSystem()
                throws ActivationException;

        protected void activeObject(ActivationID id, 
                                    java.rmi.MarshalledObject mobj)             
                throws ActivationException, UnknownObjectException,
                       java.rmi.RemoteException;

        protected void inactiveGroup()
                throws UnknownGroupException, java.rmi.RemoteException;
                                                                                
}
</pre>
<a name="a1904" id="a1904"><!-- --></a> The activator calls an
activation group&#39;s <code>newInstance</code> method in order to
activate an object with the activation descriptor, <em>desc</em>.
The activation group is responsible for:
<ul>
<li><a name="a1908" id="a1908"><!-- --></a> determining the class
for the object using the descriptor&#39;s <code>getClassName</code>
method,</li>
<li><a name="a1911" id="a1911"><!-- --></a> loading the class from
the URL path obtained from the descriptor (using the
<code>getLocation</code> method),</li>
<li><a name="a1912" id="a1912"><!-- --></a> creating an instance of
the class by invoking the special constructor of the object&#39;s
class that takes two arguments: the object&#39;s
<code>ActivationID</code>, and a <code>MarshalledObject</code>
containing the object&#39;s initialization data, and</li>
<li><a name="a1917" id="a1917"><!-- --></a> returning a serialized
version of the remote object it just created to the activator.</li>
</ul>
<a name="a4946" id="a4946"><!-- --></a> The method throws
<code>ActivationException</code> if the instance for the given
descriptor could not be created.
<p><a name="a4948" id="a4948"><!-- --></a> The group's
<code>inactiveObject</code> method is called indirectly via a call
to the <code>Activatable.inactive</code> method. A remote object
implementation must call <code>Activatable</code>'s
<code>inactive</code> method when that object deactivates (the
object deems that it is no longer active). If the object does not
call <code>Activatable.inactive</code> when it deactivates, the
object will never be garbage collected since the group keeps strong
references to the objects it creates.</p>
<p><a name="a5013" id="a5013"><!-- --></a> The group's
<code>inactiveObject</code> method unexports the remote object,
associated with <em>id</em> (only if there are no pending or
executing calls to the remote object) from the RMI runtime so that
the object can no longer receive incoming RMI calls. If the object
currently has pending or executing calls,
<code>inactiveObject</code> returns <code>false</code> and no
action is taken.</p>
<p><a name="a5852" id="a5852"><!-- --></a> If the
<code>unexportObject</code> operation was successful (meaning that
the object has no pending or executing calls), the group informs
its <code>ActivationMonitor</code> (via the monitor's
<code>inactiveObject</code> method) that the remote object is not
currently active so that the remote object will be reactivated by
the activator upon a subsequent activation request. If the
operation was successful, <code>inactiveObject</code> returns
<code>true</code>. The operation may still succeed if the object is
considered active by the <code>ActivationGroup</code> but has
already been unexported.</p>
<p><a name="a5041" id="a5041"><!-- --></a> The
<code>inactiveObject</code> method throws an
<code>UnknownObjectException</code> if the activation group has no
knowledge of this object (e.g., the object was previously reported
as inactive, or the object was never activated via the activation
group). If the inactive operation fails (e.g., if the remote call
to the activator or activation group fails),
<code>RemoteException</code> is thrown.</p>
<p><a name="a5145" id="a5145"><!-- --></a> The
<code>createGroup</code> method creates and sets the activation
group for the current JVM. The activation group can only be set if
it is not currently set. An activation group is set using the
<code>createGroup</code> method when the <code>Activator</code>
initiates the re-creation of an activation group in order to carry
out incoming <code>activate</code> requests. A group must first
register a group descriptor with the <code>ActivationSystem</code>
before it can be created via this method (passing it the
<code>ActivationID</code> obtained from previous registration).</p>
<p><a name="a5149" id="a5149"><!-- --></a> The group specified by
the <code>ActivationGroupDesc</code>, <em>desc</em>, must be a
concrete subclass of <code>ActivationGroup</code> and have a public
constructor that takes two arguments; the
<code>ActivationGroupID</code> for the group and a
<code>MarshalledObject</code> containing the group&#39;s
initialization data (obtained from its
<code>ActivationGroupDesc</code>). If the
<code>ActivationGroupDesc.getClassName</code> method returns
<code>null</code>, the system&#39;s default group implementation is
used. Note: if your application creates its own custom activation
group, the group must set a security manager in the constructor, or
objects cannot be activated in the group.</p>
<p><a name="a5150" id="a5150"><!-- --></a> After the group is
created, the <code>ActivationSystem</code> is informed that the
group is active by calling the <code>activeGroup</code> method,
which returns the <code>ActivationMonitor</code> for the group. The
application need not call <code>activeGroup</code> independently
since that callback is taken care of by the
<code>createGroup</code> method.</p>
<p><a name="a5152" id="a5152"><!-- --></a> Once a group is created,
subsequent calls to the <code>currentGroupID</code> method will
return the identifier for this group until the group becomes
inactive, at which point the <code>currentGroupID</code> method
will return <code>null</code>.</p>
<p><a name="a5157" id="a5157"><!-- --></a> The parameter
<em>incarnation</em> indicates the current group incarnation, i.e.,
the number of times the group has been activated. The incarnation
number is used as a parameter to the <code>activeGroup</code>
method, once the group has been successfully created. The
incarnation number is zero-based. If the group already exists, or
if an error occurs during group creation, the
<code>createGroup</code> method throws
<code>ActivationException</code>.</p>
<p><a name="a5171" id="a5171"><!-- --></a> The
<code>setSystem</code> method sets the
<code>ActivationSystem</code>, <em>system</em>, for the JVM. The
activation system can only be set if no group is currently active.
If the activation system is not set via an explicit call to
<code>setSystem</code>, then the <code>getSystem</code> method will
attempt to obtain a reference to the <code>ActivationSystem</code>
by looking up the name
<em>java.rmi.activation.ActivationSystem</em> in the
Activator&#39;s registry. By default, the port number used to look
up the activation system is defined by
<em>ActivationSystem.SYSTEM_PORT</em>. This port can be overridden
by setting the property <em>java.rmi.activation.port</em>. If the
activation system is already set when <code>setSystem</code> is
called, the method throws <code>ActivationException</code>.</p>
<p><a name="a5178" id="a5178"><!-- --></a> The
<code>getSystem</code> method returns the activation system for the
JVM. The activation system may be set by the <code>setSystem</code>
method (described above).</p>
<p><a name="a5179" id="a5179"><!-- --></a> The
<code>activeObject</code> method is a protected method used by
subclasses to make the <code>activeObject</code> call back to the
group&#39;s monitor to inform the monitor that the remote object
with the specified activation <em>id</em> and whose stub is
contained in <em>mobj</em> is now active. The call is simply
forwarded to the group&#39;s <code>ActivationMonitor</code>.</p>
<p><a name="a5182" id="a5182"><!-- --></a> The
<code>inactiveGroup</code> method is a protected method used by
subclasses to inform the group&#39;s monitor that the group has
become inactive. A subclass makes this call when each object the
group participated in activating in the JVM has become
inactive.</p>
<p><br /></p>
<h3><i>7.4.9</i> The <code>MarshalledObject</code> Class</h3>
<a name="a2240" id="a2240"><!-- --></a> A
<code>MarshalledObject</code> is a container for an object that
allows that object to be passed as a parameter in an RMI call, but
postpones deserializing the object at the receiver until the
application explicitly requests the object (via a call to the
container object). The <code>Serializable</code> object contained
in the <code>MarshalledObject</code> is serialized and deserialized
(when requested) with the same semantics as parameters passed in
RMI calls, which means that any remote object in the
<code>MarshalledObject</code> is represented by a serialized
instance of its stub. The object contained by the
<code>MarshalledObject</code> may be a remote object, a non-remote
object, or an entire graph of remote and non-remote objects.
<p><a name="a5680" id="a5680"><!-- --></a> When an object is placed
inside the <code>MarshalledObject</code> wrapper, the serialized
form of the object is annotated with the codebase URL (where the
class can be loaded); likewise, when the contained object is
retrieved from its <code>MarshalledObject</code> wrapper, if the
code for the object is not available locally, the URL (annotated
during serialization) is used to locate and load the bytecodes for
the object&#39;s class.</p>
<pre class="codeblock">
package java.rmi;<br />public final class MarshalledObject implements java.io.Serializable
{
        public MarshalledObject(Object obj)
                throws java.io.IOException;

        public Object get()
                throws java.io.IOException, ClassNotFoundException;

        public int hashCode();

        public boolean equals();
}
</pre>
<a name="a3250" id="a3250"><!-- --></a>
<code>MarshalledObject</code>&#39;s constructor takes a
serializable object, <em>obj</em>, as its single argument and holds
the marshalled representation of the object in a byte stream. The
marshalled representation of the object preserves the semantics of
objects that are passed in RMI calls:
<ul>
<li><a name="a3257" id="a3257"><!-- --></a> each class in the
stream is annotated with its codebase URL so that when the object
is reconstructed (by a call to the <code>get</code> method), the
bytecodes for each class can be located and loaded, and</li>
<li><a name="a3258" id="a3258"><!-- --></a> remote objects are
replaced with their proxy stubs.</li>
</ul>
<a name="a2586" id="a2586"><!-- --></a> When an instance of the
class <code>MarshalledObject</code> is written to a
<code>java.io.ObjectOutputStream</code>, the contained object&#39;s
marshalled form (created during construction) is written to the
stream; thus, only the byte stream is serialized.
<p><a name="a2331" id="a2331"><!-- --></a> When a
<code>MarshalledObject</code> is read from a
<code>java.io.ObjectInputStream</code>, the contained object is not
deserialized into a concrete object; the object remains in its
marshalled representation until the marshalled object&#39;s
<code>get</code> method is called.</p>
<p><a name="a2330" id="a2330"><!-- --></a> The <code>get</code>
method always reconstructs a new copy of the contained object from
its marshalled form. The internal representation is deserialized
with the semantics used for unmarshalling parameters for RMI calls.
So, the deserialization of the object&#39;s representation loads
class code (if not available locally) using the URL annotation
embedded in the serialized stream for the object.</p>
<p><a name="a5451" id="a5451"><!-- --></a> The
<code>hashCode</code> of the marshalled representation of the
object is the same as the object passed to the constructor. The
<code>equals</code> method will return true if the marshalled
representation of the objects being compared are equivalent. The
comparison that equals uses ignores a class&#39;s codebase
annotation, meaning that two objects are equivalent if they have
the same serialized representation <em>except</em> for the codebase
of each class in the serialized representation.</p>
<p><a name="a2126" id="a2126"><!-- --></a></p>
<p><br /></p>
<hr />
<a href="rmiTOC.html">CONTENTS</a> | <a href=
"rmi-activation4.html">PREV</a> | <a href=
"rmi-stubs2a.html">NEXT</a>
<hr />
Copyright 1997, 2010, Oracle and/or its affiliates. All rights
reserved.
</body>
</html>
